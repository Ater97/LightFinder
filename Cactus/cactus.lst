---------------------------------------------
PIC ASSEMBLER LISTING
Line    Address Opcode  Instruction
---------------------------------------------
0001    0000            
0002    0000            DATO  	EQU 0x21
0003    0000            COUNTY 	EQU 0x22
0004    0000            COUNTX 	EQU 0x23
0005    0000            LIMITY 	EQU 0x24
0006    0000            LIMITX 	EQU 0x25
0007    0000            P1	  	EQU 0x26
0008    0000            P2    	EQU 0x27
0009    0000            COUNTBETA EQU 0x28
0010    0000            LIMITBETA EQU 0x29
0011    0000            
0012    0000            VARMAXX	EQU	0x30
0013    0000            VARMAXY	EQU	0x31
0014    0000            VARPHOTOCELL EQU 0x32
0015    0000            TMPCELL EQU 0x33
0016    0000            TMPY    EQU 0x34
0017    0000            TMPX    EQU 0x35
0018    0000            TMPBETA EQU 0x36
0019    0000            VARMAXBETA  EQU 0x37
0020    0000            LIMITMAXX   EQU 0x38
0021    0000            LIMITMAXY   EQU 0x39
0022    0000            LIMITMAXBETA EQU 0x40
0023    0000            
0024    0000            VAR1    EQU 0x41
0025    0000            VAR2    EQU 0x42
0026    0000            VAR3    EQU 0x43
0027    0000            VAR4    EQU 0x44
0028    0000            cont    EQU 0x45 
0029    0000            ADC     EQU 0x46
0030    0000            CON     EQU 0x47
0031    0000            CON2    EQU 0x48
0032    0000            CON3    EQU 0x49
0033    0000            
0034    0000            INICIO
0035    0000            
0036    0000            	ORG		0x00
0037    0000    2801    	GOTO	START
0038    0001            
0039    0001            START
0040    0001            	;1 = in        0  = out
0041    0001            	;BIT SET FILE
0042    0001    1683    	BSF 	STATUS, 5; COLOCAMOS EN S EL BIT 5 DE REG. ESTATUS
0043    0002    0186    	CLRF	TRISB
0044    0003    0188    	CLRF	TRISD   
0045    0004            	                    ;BIT CLEARE FILE
0046    0004    1283    	BCF		STATUS, RP0 ;TODOS LOS PINES DE B SON SALIDAS
0047    0005            
0048    0005    3000    	MOVLW	0x00
0049    0006    0086    	MOVWF 	PORTB  ; SET 0 TO ALL PORTS B
0050    0007    3000    	MOVLW	0x00
0051    0008    0088    	MOVWF 	PORTD  ; SET 0 TO ALL PORTS B
0052    0009    30E6    	MOVLW 	0xE6        ;NUMBER OF MOVES/STOPS IN Y, E6h = 230d
0053    000A    00A4    	MOVWF 	LIMITY 
0054    000B    3020    	MOVLW 	0x20        ;NUMBER OF MOVES IN X
0055    000C    00A5    	MOVWF 	LIMITX 
0056    000D    3010    	MOVLW	0x10	    ;NUMBER OF STOPS IN X, 10h = 16d
0057    000E    00A9    	MOVWF	LIMITBETA
0058    000F    20A2    	call 	CLEANY      ;SET COUNTERS TO 0
0059    0010    20A5    	call 	CLEANX
0060    0011    20A8    	call 	CLEANBETA
0061    0012            
0062    0012                            ;CONFIGURATION FOR THE PHOTOCELL 
0063    0012    1283     	bcf STATUS,RP0 ;Ir banco 0
0064    0013    1303    	bcf STATUS,RP1
0065    0014    3041    	movlw b'01000001' ;A/D conversion Fosc/8
0066    0015    009F    	movwf ADCON0
0067    0016            	;     	     7     6     5    4    3    2       1 0
0068    0016            	; 1Fh ADCON0 ADCS1 ADCS0 CHS2 CHS1 CHS0 GO/DONE � ADON
0069    0016    1683    	bsf STATUS,RP0 ;Ir banco 1
0070    0017    1303    	bcf STATUS,RP1
0071    0018    3007    	movlw b'00000111'
0072    0019    0081    	movwf OPTION_REG ;TMR0 preescaler, 1:156
0073    001A            	;                7    6      5    4    3   2   1   0 
0074    001A            	; 81h OPTION_REG RBPU INTEDG T0CS T0SE PSA PS2 PS1 PS0
0075    001A    300E    	movlw b'00001110' ;A/D Port AN0/RA0
0076    001B    009F    	movwf ADCON1
0077    001C            	;            7    6     5 4 3     2     1     0 
0078    001C            	; 9Fh ADCON1 ADFM ADCS2 � � PCFG3 PCFG2 PCFG1 PCFG0
0079    001C    1405    	bsf TRISA,0 ;RA0 linea de entrada para el ADC
0080    001D            	;clrf TRISB
0081    001D    1283    	bcf STATUS,RP0 ;Ir banco 0
0082    001E    1303    	bcf STATUS,RP1
0083    001F    0186    	clrf PORTB ;Limpiar PORTB   
0084    0020            ;--------------------------------------------------------------------
0085    0020            ;--------------------------------------------------------------------
0086    0020            						;MAIN
0087    0020            MAIN:
0088    0020    2025        call    SEARCH      ;SEARCH BEST POINT
0089    0021    202E        call    MOVEGREATER ;GO TO BEST POINT
0090    0022              
0091    0022            WHAIT:   
0092    0022                ;DO STUFF
0093    0022                ;BTFSS	BUTTON
0094    0022    2822        GOTO    WHAIT
0095    0023            
0096    0023    2037        call    RESTART      ;RETURN TO ORIGINAL POSITION & CLEAN EVERYTHING
0097    0024    2820        GOTO    MAIN
0098    0025            
0099    0025            SEARCH:
0100    0025            
0101    0025    2076    	call	LOOPX ; MOVE X AND Y
0102    0026    0AA8    	INCF	COUNTBETA,1
0103    0027    0829    	MOVF	LIMITBETA, W	
0104    0028    0228    	SUBWF	COUNTBETA, w
0105    0029    1D03    	BTFSS	STATUS,Z
0106    002A    2825    	GOTO	SEARCH
0107    002B    20A8    	call	CLEANBETA   ;CLEAN COUNTBETA
0108    002C    206F    	call 	LOOPBETAREVERSE    ;RETURN TO ORIGINAL POSITION
0109    002D    0008        RETURN
0110    002E            
0111    002E            ;------------------------------------------------------------------
0112    002E                                    ;MOVE TO GREATER
0113    002E            MOVEGREATER:
0114    002E            
0115    002E    2041    	call	LOOPXMAX ; MOVE X 
0116    002F    0AA8    	INCF	COUNTBETA,1
0117    0030    0840    	MOVF	LIMITMAXBETA, W	
0118    0031    0228    	SUBWF	COUNTBETA, w
0119    0032    1D03    	BTFSS	STATUS,Z
0120    0033    282E    	GOTO	MOVEGREATER
0121    0034    2049        call	LOOPYMAX ; MOVE Y
0122    0035    20A8        call	CLEANBETA
0123    0036    0008        RETURN
0124    0037            
0125    0037            RESTART:
0126    0037    203A        call    LOOPMAXBETAREVERSE
0127    0038    2051        call 	LOOPYREVERSEMAX
0128    0039    0008        RETURN
0129    003A            
0130    003A            LOOPMAXBETAREVERSE:
0131    003A    2059    	call 	LOOPXREVERSEMAX
0132    003B            	
0133    003B    0AA8    	INCF	COUNTBETA,1
0134    003C    0840    	MOVF	LIMITMAXBETA, W	
0135    003D    0228    	SUBWF	COUNTBETA, w
0136    003E    1D03    	BTFSS	STATUS,Z
0137    003F    283A    	GOTO	LOOPMAXBETAREVERSE
0138    0040    0008        RETURN
0139    0041            
0140    0041            LOOPXMAX:
0141    0041    20AB    	call 	EJEX
0142    0042            
0143    0042            	;MOVE ON X
0144    0042    0AA3        INCF    COUNTX,1    
0145    0043    0838    	MOVF  	LIMITMAXX, w
0146    0044    0223    	SUBWF 	COUNTX,w
0147    0045    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT < limitx
0148    0046    2841    	GOTO 	LOOPXMAX	; JUMP IF COUNT !=  limitx
0149    0047            	
0150    0047    20A5    	call 	CLEANX
0151    0048    0008    	RETURN
0152    0049            
0153    0049            LOOPYMAX:
0154    0049    20B0    	call 	EJEY
0155    004A            	;MOVE ON Y
0156    004A    0AA2        INCF    COUNTY,1 ;count++
0157    004B    0839    	MOVF  	LIMITMAXY, w
0158    004C    0222    	SUBWF 	COUNTY,w
0159    004D    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT < limity
0160    004E    2849    	GOTO 	LOOPYMAX	; JUMP IF COUNT !=  limity
0161    004F            	;RESET  countY
0162    004F    20A2    	call 	CLEANY
0163    0050    0008    	return
0164    0051            
0165    0051            
0166    0051            LOOPYREVERSEMAX:
0167    0051    20B5    	call 	REVERSEEJEY
0168    0052    0AA2        INCF    COUNTY,1
0169    0053    0839    	MOVF  	LIMITMAXY, w
0170    0054    0222    	SUBWF 	COUNTY,w
0171    0055    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT <32
0172    0056    2851    	GOTO 	LOOPYREVERSEMAX
0173    0057    20A2    	call 	CLEANY
0174    0058    0008    	RETURN
0175    0059            
0176    0059            LOOPXREVERSEMAX:
0177    0059    20BA    	call 	REVERSEEJEX
0178    005A    0AA3        INCF    COUNTX,1
0179    005B            	
0180    005B    0838    	MOVF  	LIMITMAXX, w
0181    005C    0223    	SUBWF 	COUNTX,w
0182    005D    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT <32
0183    005E    2859    	GOTO 	LOOPXREVERSEMAX
0184    005F    20A5    	call 	CLEANX
0185    0060    0008    	RETURN
0186    0061            
0187    0061            ;-------------------------------------------------------------------
0188    0061            ;                   Photocell comparation
0189    0061            COMPARE:
0190    0061                ;TMPCELL = READ PHOTOCELL INF.
0191    0061                ;ASIGNAR A TMPCELL EL NUMERO EN LA ESCALA DE LUZ (0-9)
0192    0061            
0193    0061    0832        MOVF    VARPHOTOCELL,W
0194    0062    0233        SUBWF   TMPCELL, W ; W = VARPHOTOVELL - TMPCELL 
0195    0063    1803        BTFSC   STATUS, C   ;IF VARPHOTOCELL < TMPCELL ; c=0 if negative
0196    0064    2066        call    CHANGEPHOTOCELL    
0197    0065    0008        return
0198    0066            
0199    0066            CHANGEPHOTOCELL:
0200    0066    3033        MOVLW   TMPCELL
0201    0067    00B2        MOVWF    VARPHOTOCELL  ;PHOTOCELL =  TMPCELL
0202    0068    3034        MOVLW   TMPY
0203    0069    00B1        MOVWF   VARMAXY     ;VARMAXY = TMPY
0204    006A    3035        MOVLW   TMPX
0205    006B    00B0        MOVWF   VARMAXX     ;VARMAXX = TMPX
0206    006C    3036        MOVLW   TMPBETA
0207    006D    00B7        MOVWF   VARMAXBETA  ;VARMAXBETA = TMPBETA
0208    006E    0008        return 
0209    006F            
0210    006F            ;---------------------------------------------------------------------
0211    006F            ;                       LOOPS
0212    006F            LOOPBETAREVERSE:
0213    006F    2091    	call 	LOOPXREVERSE
0214    0070            	
0215    0070    0AA8    	INCF	COUNTBETA,1
0216    0071    0829    	MOVF	LIMITBETA, W	
0217    0072    0228    	SUBWF	COUNTBETA, w
0218    0073    1D03    	BTFSS	STATUS,Z
0219    0074    286F    	GOTO	LOOPBETAREVERSE
0220    0075    0008    	RETURN
0221    0076            
0222    0076            LOOPX: ; LOOP i <= LIMITX
0223    0076    20AB    	call 	EJEX
0224    0077            
0225    0077            	;MOVE ON X
0226    0077    0AA3        INCF    COUNTX,1
0227    0078    0825    	MOVF  	LIMITX, w
0228    0079    0223    	SUBWF 	COUNTX,w
0229    007A    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT < limitx
0230    007B    2876    	GOTO 	LOOPX	; JUMP IF COUNT !=  limitx
0231    007C    207F    	call	LOOPY ; MOVE Y
0232    007D            
0233    007D    20A5    	call 	CLEANX
0234    007E    0008    	RETURN
0235    007F            
0236    007F            LOOPY: ;LOOP i <= LIMITY
0237    007F    20B0    	call 	EJEY
0238    0080            	;INSERT LOGIC COMPARE VALUE OF PHOTOCELL & SAVE IT
0239    0080                ;maybe add a delay here \o/
0240    0080    2061        call    COMPARE
0241    0081            
0242    0081            	;MOVE ON Y
0243    0081    0AA2        INCF    COUNTY,1
0244    0082    0824    	MOVF  	LIMITY, w
0245    0083    0222    	SUBWF 	COUNTY,w
0246    0084    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT < limity
0247    0085    287F    	GOTO 	LOOPY	; JUMP IF COUNT !=  limity
0248    0086            	;RESET Y
0249    0086    20A2    	call 	CLEANY
0250    0087    2089    	call 	LOOPYREVERSE
0251    0088    0008    	return
0252    0089            
0253    0089            LOOPYREVERSE:
0254    0089    20B5    	call 	REVERSEEJEY
0255    008A    0AA2        INCF    COUNTY,1
0256    008B    0824    	MOVF  	LIMITY, w
0257    008C    0222    	SUBWF 	COUNTY,w
0258    008D    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT <32
0259    008E    2889    	GOTO 	LOOPYREVERSE
0260    008F    20A2    	call 	CLEANY
0261    0090    0008    	RETURN
0262    0091            
0263    0091            LOOPXREVERSE:
0264    0091    20BA    	call 	REVERSEEJEX
0265    0092    0AA3        INCF    COUNTX,1
0266    0093    0825    	MOVF  	LIMITX, w
0267    0094    0223    	SUBWF 	COUNTX,w
0268    0095    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT <32
0269    0096    2891    	GOTO 	LOOPXREVERSE
0270    0097    20A5    	call 	CLEANX
0271    0098    0008    	RETURN
0272    0099            ;-------------------------------------------------------------------
0273    0099            ;						DELAYS
0274    0099            Delay ; = 0.0001 seconds
0275    0099            			;496 cycles
0276    0099    30A5    	movlw	0xA5
0277    009A    00A6    	movwf	p1
0278    009B            Delay_0
0279    009B    0BA6    	decfsz	p1, f
0280    009C    289B    	goto	Delay_0
0281    009D            
0282    009D            			;4 cycles (including call)
0283    009D    0008    	return
0284    009E            ;-------------------------------------------------------------------
0285    009E            ;						UTILITIES
0286    009E            MV:	
0287    009E    2099    	call 	DELAY
0288    009F    0821    	MOVF	DATO, W  
0289    00A0    0088    	MOVWF	PORTD	
0290    00A1    0008    	RETURN
0291    00A2            CLEANY:
0292    00A2    3000    	MOVLW 	0x00  ;se asigna la literal a w (0x00)
0293    00A3    00A2    	MOVWF 	COUNTY ;muevo w a COUNT 
0294    00A4    0008    	RETURN
0295    00A5            CLEANX:
0296    00A5    3000    	MOVLW 	0x00  ;se asigna la literal a w (0x00)
0297    00A6    00A3    	MOVWF 	COUNTX ;muevo w a COUNT 
0298    00A7    0008    	RETURN
0299    00A8            CLEANBETA:
0300    00A8    3000    	MOVLW 	0x00  ;se asigna la literal a w (0x00)
0301    00A9    00A8    	MOVWF 	COUNTBETA ;muevo w a COUNT 
0302    00AA    0008    	RETURN
0303    00AB            EJEX:	
0304    00AB    20E3    	call	MV12
0305    00AC    20D3    	call	MV06
0306    00AD    20C7    	call	MV03
0307    00AE    20DF    	call	MV09
0308    00AF    0008    	RETURN
0309    00B0            EJEY:	
0310    00B0    210F    	call	MVY12
0311    00B1    20FF    	call	MVY6
0312    00B2    20F3    	call	MVY3
0313    00B3    210B    	call	MVY9
0314    00B4    0008    	RETURN
0315    00B5            REVERSEEJEY:
0316    00B5    210B    	call	MVY9
0317    00B6    20F3    	call	MVY3
0318    00B7    20FF    	call	MVY6
0319    00B8    210F    	call	MVY12
0320    00B9    0008    	RETURN
0321    00BA            REVERSEEJEX:
0322    00BA    20DF    	call  	MV09
0323    00BB    20C7    	call	MV03
0324    00BC    20D3    	call	MV06
0325    00BD    20E3    	call	MV12
0326    00BE    0008    	RETURN
0327    00BF            
0328    00BF            MV01:	
0329    00BF    3001    	MOVLW	B'00000001'
0330    00C0    00A1    	MOVWF	DATO
0331    00C1    209E    	call	MV
0332    00C2    0008    	RETURN
0333    00C3            
0334    00C3            MV02:
0335    00C3    3002    	MOVLW	B'00000010'
0336    00C4    00A1    	MOVWF	DATO
0337    00C5    209E    	call	MV
0338    00C6    0008    	RETURN
0339    00C7            MV03:	
0340    00C7    3003    	MOVLW	B'00000011'
0341    00C8    00A1    	MOVWF	DATO
0342    00C9    209E    	call	MV
0343    00CA    0008    	RETURN
0344    00CB            
0345    00CB            MV04:
0346    00CB    3004    	MOVLW	B'00000100'
0347    00CC    00A1    	MOVWF	DATO
0348    00CD    209E    	call	MV
0349    00CE    0008    	RETURN
0350    00CF            MV05:
0351    00CF    3005    	MOVLW	B'00000101'
0352    00D0    00A1    	MOVWF	DATO
0353    00D1    209E    	call	MV
0354    00D2    0008    	RETURN
0355    00D3            MV06:
0356    00D3    3006    	MOVLW	B'00000110'
0357    00D4    00A1    	MOVWF	DATO
0358    00D5    209E    	call	MV
0359    00D6    0008    	RETURN
0360    00D7            MV07:
0361    00D7    3007    	MOVLW	B'00000111'
0362    00D8    00A1    	MOVWF	DATO
0363    00D9    209E    	call	MV
0364    00DA    0008    	RETURN
0365    00DB            MV08:
0366    00DB    3008    	MOVLW	B'00001000'
0367    00DC    00A1    	MOVWF	DATO
0368    00DD    209E    	call	MV
0369    00DE    0008    	RETURN
0370    00DF            MV09:
0371    00DF    3009    	MOVLW	B'00001001'
0372    00E0    00A1    	MOVWF	DATO
0373    00E1    209E    	call	MV
0374    00E2    0008    	RETURN
0375    00E3            MV12:
0376    00E3    300C    	MOVLW	B'00001100'
0377    00E4    00A1    	MOVWF	DATO
0378    00E5    209E    	call	MV
0379    00E6    0008    	RETURN
0380    00E7            MVy0:
0381    00E7    3000    	MOVLW	B'00000000'
0382    00E8    00A1    	MOVWF	DATO
0383    00E9    209E    	call	MV
0384    00EA    0008    	RETURN
0385    00EB            MVY1:
0386    00EB    3010    	MOVLW	B'00010000'
0387    00EC    00A1    	MOVWF	DATO
0388    00ED    209E    	call	MV
0389    00EE    0008    	RETURN
0390    00EF            MVY2:
0391    00EF    3020    	MOVLW	B'00100000'
0392    00F0    00A1    	MOVWF	DATO
0393    00F1    209E    	call	MV
0394    00F2    0008    	RETURN
0395    00F3            MVY3:
0396    00F3    3030    	MOVLW	B'00110000'
0397    00F4    00A1    	MOVWF	DATO
0398    00F5    209E    	call	MV
0399    00F6    0008    	RETURN
0400    00F7            MVY4:
0401    00F7    3040    	MOVLW	B'01000000'
0402    00F8    00A1    	MOVWF	DATO
0403    00F9    209E    	call	MV
0404    00FA    0008    	RETURN
0405    00FB            MVY5:
0406    00FB    3050    	MOVLW	B'01010000'
0407    00FC    00A1    	MOVWF	DATO
0408    00FD    209E    	call	MV
0409    00FE    0008    	RETURN
0410    00FF            MVY6:
0411    00FF    3060    	MOVLW	B'01100000'
0412    0100    00A1    	MOVWF	DATO
0413    0101    209E    	call	MV
0414    0102    0008    	RETURN
0415    0103            MVY7:
0416    0103    3070    	MOVLW	B'01110000'
0417    0104    00A1    	MOVWF	DATO
0418    0105    209E    	call	MV
0419    0106    0008    	RETURN
0420    0107            MVY8:
0421    0107    3080    	MOVLW	B'10000000'
0422    0108    00A1    	MOVWF	DATO
0423    0109    209E    	call	MV
0424    010A    0008    	RETURN
0425    010B            MVY9:
0426    010B    3090    	MOVLW	B'10010000'
0427    010C    00A1    	MOVWF	DATO
0428    010D    209E    	call	MV
0429    010E    0008    	RETURN
0430    010F            MVY12:
0431    010F    30C0    	MOVLW	B'11000000'
0432    0110    00A1    	MOVWF	DATO
0433    0111    209E    	call	MV
0434    0112    0008    	RETURN
---------------------------------------------
Number of errors = 0
