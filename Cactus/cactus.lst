---------------------------------------------
PIC ASSEMBLER LISTING
Line    Address Opcode  Instruction
---------------------------------------------
0001    0000            TEMP	EQU	0x20
0002    0000            DATO  	EQU 0x21
0003    0000            COUNTY 	EQU 0x22
0004    0000            COUNTX 	EQU 0x23
0005    0000            LIMITY 	EQU 0x24
0006    0000            LIMITX 	EQU 0x25
0007    0000            P1	  	EQU 0x26
0008    0000            P2    	EQU 0x27
0009    0000            COUNTBETA EQU 0x28
0010    0000            LIMITBETA EQU 0x29
0011    0000            
0012    0000            VARPHOTOCELL EQU 0x2A
0013    0000            TMPY    EQU 0x2B
0014    0000            TMPX    EQU 0x2C
0015    0000            TMPBETA EQU 0x2D
0016    0000            waffles	EQU 0x2E
0017    0000            LIMITMAXX   EQU 0x2F
0018    0000            LIMITMAXY   EQU 0x30
0019    0000            LIMITMAXBETA EQU 0x31
0020    0000            
0021    0000            varA    EQU 0x33
0022    0000            varB    EQU 0x34
0023    0000            varC    EQU 0x35
0024    0000            VARDISPLAY  EQU 0x36
0025    0000            cont    EQU 0x37 
0026    0000            ADC     EQU 0x38
0027    0000            CON     EQU 0x39
0028    0000            CON2    EQU 0x3A
0029    0000            CON3    EQU 0x3B
0030    0000            GROUPNUMBER	EQU 0x3C
0031    0000            
0032    0000            CounterC EQU 0x3E
0033    0000            CounterB EQU 0x3F
0034    0000            CounterA EQU 0x40
0035    0000            INICIO
0036    0000            
0037    0000            	ORG		0x00
0038    0000    2801    	GOTO	START
0039    0001            
0040    0001            START
0041    0001            	;1 = in        0  = out
0042    0001            	;BIT SET FILE
0043    0001    1683    	BSF 	STATUS, 5; COLOCAMOS EN S EL BIT 5 DE REG. ESTATUS
0044    0002    0186    	CLRF	TRISB
0045    0003    0188    	CLRF	TRISD   
0046    0004            	                    ;BIT CLEARE FILE
0047    0004    1283    	BCF		STATUS, RP0 ;TODOS LOS PINES DE B SON SALIDAS
0048    0005            
0049    0005    3000    	MOVLW	0x00
0050    0006    0086    	MOVWF 	PORTB  ; SET 0 TO ALL PORTS B
0051    0007    3000    	MOVLW	0x00
0052    0008    0088    	MOVWF 	PORTD  ; SET 0 TO ALL PORTS B
0053    0009    30E6    	MOVLW 	0xE6        ;NUMBER OF MOVES/STOPS IN Y, E6h = 230d
0054    000A    00A4    	MOVWF 	LIMITY 
0055    000B    00B0    	MOVWF	LIMITMAXY
0056    000C    3020    	MOVLW 	0x20        ;NUMBER OF MOVES IN X
0057    000D    00A5    	MOVWF 	LIMITX 
0058    000E    00AF    	MOVWF	LIMITMAXX
0059    000F    3008    	MOVLW	0x08	    ;NUMBER OF STOPS IN X, 10h = 16d 360grads
0060    0010    00A9    	MOVWF	LIMITBETA
0061    0011    00B1    	MOVWF	LIMITMAXBETA
0062    0012    3006    	MOVLW	0x06
0063    0013    00BC    	MOVWF	GROUPNUMBER
0064    0014    20D2    	call 	CLEANY      ;SET COUNTERS TO 0
0065    0015    20D5    	call 	CLEANX
0066    0016    20D8    	call 	CLEANBETA
0067    0017    20DB    	call 	CLEANVARPHOTOCELL
0068    0018            
0069    0018            ;------------------------------------------------------------------------------
0070    0018                            ;CONFIGURATION FOR THE PHOTOCELL 
0071    0018    1283    	bcf STATUS,RP0 ;Ir banco 0
0072    0019    1303    	bcf STATUS,RP1
0073    001A    3041    	movlw b'01000001' ;A/D conversion Fosc/8
0074    001B    009F    	movwf ADCON0
0075    001C            	;     	     7     6     5    4    3    2       1 0
0076    001C            	; 1Fh ADCON0 ADCS1 ADCS0 CHS2 CHS1 CHS0 GO/DONE ? ADON
0077    001C    1683    	bsf STATUS,RP0 ;Ir banco 1
0078    001D    1303    	bcf STATUS,RP1
0079    001E    3007    	movlw b'00000111'
0080    001F    0081    	movwf OPTION_REG ;TMR0 preescaler, 1:156
0081    0020            	;                7    6      5    4    3   2   1   0 
0082    0020            	; 81h OPTION_REG RBPU INTEDG T0CS T0SE PSA PS2 PS1 PS0
0083    0020    300E    	movlw b'00001110' ;A/D Port AN0/RA0
0084    0021    009F    	movwf ADCON1
0085    0022            	;            7    6     5 4 3     2     1     0 
0086    0022            	; 9Fh ADCON1 ADFM ADCS2 ? ? PCFG3 PCFG2 PCFG1 PCFG0
0087    0022    1405    	bsf TRISA,0 ;RA0 linea de entrada para el ADC
0088    0023                	;Port A: display output
0089    0023    1085        	bcf	TRISA, 1
0090    0024    1105       	bcf	TRISA, 2
0091    0025    1185        	bcf	TRISA, 3
0092    0026    1205       	bcf	TRISA, 4
0093    0027    1285        	bcf	TRISA, 5
0094    0028    1009        	bcf	TRISE, 0
0095    0029    1089        	bcf	TRISE, 1
0096    002A    0186    	clrf TRISB
0097    002B    1283    	bcf STATUS,RP0 ;Ir banco 0
0098    002C    1303    	bcf STATUS,RP1
0099    002D            ;--------------------------------------------------------------------
0100    002D            ;--------------------------------------------------------------------
0101    002D            						;MAIN
0102    002D            MAIN:
0103    002D    203B        call    SEARCH      ;SEARCH BEST POINT
0104    002E    2046        call    MOVEGREATER ;GO TO BEST POINT
0105    002F    082A    	MOVFW	VARPHOTOCELL
0106    0030    00B6    	MOVWF	VARDISPLAY
0107    0031    21FF    	call	SHOWVARDISPLAY
0108    0032            WAIT:   
0109    0032                ;DO STUFF WITH THE BUTTON
0110    0032            
0111    0032    1D09        BTFSS	PORTE,2
0112    0033    2832        GOTO    WAIT
0113    0034            ;--------------------------------------------------------------------
0114    0034            						;BUTTON
0115    0034            BUTTONLOOP:
0116    0034    083C    	MOVFW	GROUPNUMBER
0117    0035    00B6    	MOVWF	VARDISPLAY
0118    0036    21FF    	CALL	SHOWVARDISPLAY
0119    0037            	
0120    0037    2834    	GOTO	BUTTONLOOP
0121    0038            
0122    0038            
0123    0038    2051        call    RESTART      ;RETURN TO ORIGINAL POSITION & CLEAN EVERYTHING
0124    0039    282D        GOTO    MAIN
0125    003A    2A78        GOTO    END
0126    003B            SEARCH:
0127    003B    20A4    	call	LOOPX ; MOVE X AND Y
0128    003C            
0129    003C    0828    	MOVF 	COUNTBETA, W
0130    003D    00AD    	MOVWF	TMPBETA
0131    003E            
0132    003E    0AA8    	INCF	COUNTBETA,1
0133    003F    0829    	MOVF	LIMITBETA, W	
0134    0040    0228    	SUBWF	COUNTBETA, w
0135    0041    1D03    	BTFSS	STATUS,Z
0136    0042    283B    	GOTO	SEARCH
0137    0043    20D8    	call	CLEANBETA   ;CLEAN COUNTBETA
0138    0044    209C    	call 	LOOPBETAREVERSE    ;RETURN TO ORIGINAL POSITION
0139    0045    0008        RETURN
0140    0046            
0141    0046            ;------------------------------------------------------------------
0142    0046                                    ;MOVE TO GREATER
0143    0046            MOVEGREATER:
0144    0046    2064    	call	LOOPYMAX ; MOVE Y
0145    0047    2049    	call	LOOPXMAXBETA ; MOVE X 
0146    0048            	;call 	LOOPXMAX
0147    0048    0008    	return
0148    0049            LOOPXMAXBETA:
0149    0049    205C    	call 	LOOPXMAX
0150    004A            
0151    004A    0AA8    	INCF	COUNTBETA,1
0152    004B    0831    	MOVF	LIMITMAXBETA, W	
0153    004C    0228    	SUBWF	COUNTBETA, w
0154    004D    1D03    	BTFSS	STATUS,Z
0155    004E    2849    	GOTO	LOOPXMAXBETA
0156    004F    20D8        call	CLEANBETA
0157    0050    0008        RETURN
0158    0051            
0159    0051            RESTART:
0160    0051    2055        call    LOOPMAXBETAREVERSE
0161    0052    206C        call 	LOOPYREVERSEMAX
0162    0053    20DB    	call 	CLEANVARPHOTOCELL
0163    0054    0008        RETURN
0164    0055            VAR
0165    0055            LOOPMAXBETAREVERSE:
0166    0055    2074    	call 	LOOPXREVERSEMAX
0167    0056            	
0168    0056    0AA8    	INCF	COUNTBETA,1
0169    0057    0831    	MOVF	LIMITMAXBETA, W	
0170    0058    0228    	SUBWF	COUNTBETA, w
0171    0059    1D03    	BTFSS	STATUS,Z
0172    005A    2855    	GOTO	LOOPMAXBETAREVERSE
0173    005B    0008        RETURN
0174    005C            
0175    005C            LOOPXMAX:	
0176    005C    20DE    	call 	EJEX
0177    005D            	;MOVE ON X
0178    005D    0AA3        INCF    COUNTX,1
0179    005E    0825    	MOVF  	LIMITX, w
0180    005F    0223    	SUBWF 	COUNTX,w
0181    0060    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT < limitx
0182    0061    285C    	GOTO 	LOOPXMAX	; JUMP IF COUNT !=  limitx
0183    0062    20D5    	call 	CLEANX
0184    0063    0008    	RETURN
0185    0064            
0186    0064            LOOPYMAX:
0187    0064    20E3    	call 	EJEY
0188    0065            	;MOVE ON Y
0189    0065    0AA2        INCF    COUNTY,1 ;count++
0190    0066    0830    	MOVF  	LIMITMAXY, w
0191    0067    0222    	SUBWF 	COUNTY,w
0192    0068    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT < limity
0193    0069    2864    	GOTO 	LOOPYMAX	; JUMP IF COUNT !=  limity
0194    006A            	;RESET  countY
0195    006A    20D2    	call 	CLEANY
0196    006B    0008    	return
0197    006C            
0198    006C            
0199    006C            LOOPYREVERSEMAX:
0200    006C    20E8    	call 	REVERSEEJEY
0201    006D    0AA2        INCF    COUNTY,1
0202    006E    0830    	MOVF  	LIMITMAXY, w
0203    006F    0222    	SUBWF 	COUNTY,w
0204    0070    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT <32
0205    0071    286C    	GOTO 	LOOPYREVERSEMAX
0206    0072    20D2    	call 	CLEANY
0207    0073    0008    	RETURN
0208    0074            
0209    0074            LOOPXREVERSEMAX:
0210    0074    20ED    	call 	REVERSEEJEX
0211    0075    0AA3        INCF    COUNTX,1
0212    0076            	
0213    0076    082F    	MOVF  	LIMITMAXX, w
0214    0077    0223    	SUBWF 	COUNTX,w
0215    0078    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT <32
0216    0079    2874    	GOTO 	LOOPXREVERSEMAX
0217    007A    20D5    	call 	CLEANX
0218    007B    0008    	RETURN
0219    007C            
0220    007C            ;-------------------------------------------------------------------
0221    007C            ;                   Photocell comparation
0222    007C            	;result		carry zero (status)
0223    007C            	;positive     1		0
0224    007C            	;zero		  1		1
0225    007C            	;negative     0     0
0226    007C            COMPARE: ;ASIGNAR A TMPCELL EL NUMERO EN LA ESCALA DE LUZ (0-9)
0227    007C    00AE        MOVWF   Waffles
0228    007D    022A        SUBWF   VARPHOTOCELL, W ; W = VARPHOTOCELL - TMPCELL 
0229    007E    1C03        BTFSS   STATUS, C   ;IF VARPHOTOCELL < TMPCELL ; c=0 if negative
0230    007F    2087        call    CHANGEPHOTOCELL   
0231    0080            	;goto 	DimeElGordito 
0232    0080    0008        return
0233    0081            
0234    0081            SETZERPY:
0235    0081    3001    	MOVLW	0x01
0236    0082    288E    	GOTO	SETy
0237    0083            SETZERPX:
0238    0083    3001    	MOVLW	0x01
0239    0084    2894    	GOTO	SETX
0240    0085            SETZERPBETA:
0241    0085    3001    	MOVLW	0x01
0242    0086    289A    	GOTO	SETBETA
0243    0087            
0244    0087            
0245    0087            CHANGEPHOTOCELL:
0246    0087    082E        MOVFW   waffles 	  ;DATO of Photocell
0247    0088    00AA        MOVWF   VARPHOTOCELL  ;PHOTOCELL =  Waffles
0248    0089            
0249    0089                
0250    0089            	;MOVFW   TMPY
0251    0089    3000    	MOVLW	0x00
0252    008A    022B    	SUBWF	TMPY,W			;TMPY - 0 
0253    008B    1903    	BTFSC	STATUS,Z		;IF TMP == 0
0254    008C    2881    	GOTO 	SETZERPY
0255    008D    082B    	MOVFW   TMPY
0256    008E            SETy:
0257    008E    00B0        MOVWF   LIMITMAXY     ;LIMITMAXY = TMPY
0258    008F            
0259    008F                ;MOVFW   TMPX
0260    008F    3000    	MOVLW	0x00
0261    0090    022C    	SUBWF	TMPX,W
0262    0091    1903    	BTFSC	STATUS,Z
0263    0092    2883    	GOTO	SETZERPX
0264    0093    082C    	MOVFW	TMPX
0265    0094            SETX:
0266    0094    00AF        MOVWF   LIMITMAXX     ;LIMITMAXX = TMPX
0267    0095            
0268    0095               ; MOVFW   TMPBETA
0269    0095    3000       	MOVLW	0x00
0270    0096    022D    	SUBWF	TMPBETA,W
0271    0097    1903    	BTFSC	STATUS,Z
0272    0098    2885    	GOTO	SETZERPBETA
0273    0099    082D    	MOVFW	TMPBETA
0274    009A            SETBETA:
0275    009A    00B1        MOVWF   LIMITMAXBETA  ;LIMITMAXBETA = TMPBETA
0276    009B    0008        return 
0277    009C            
0278    009C            ;---------------------------------------------------------------------
0279    009C            ;                       LOOPS
0280    009C            LOOPBETAREVERSE:
0281    009C    20C1    	call 	LOOPXREVERSE
0282    009D            	
0283    009D    0AA8    	INCF	COUNTBETA,1
0284    009E    0829    	MOVF	LIMITBETA, W	
0285    009F    0228    	SUBWF	COUNTBETA, w
0286    00A0    1D03    	BTFSS	STATUS,Z
0287    00A1    289C    	GOTO	LOOPBETAREVERSE
0288    00A2    20D8    	call	CLEANBETA
0289    00A3    0008    	RETURN
0290    00A4            
0291    00A4            LOOPX: ; LOOP i <= LIMITX
0292    00A4    20DE    	call 	EJEX
0293    00A5            
0294    00A5            	;MOVFW 	COUNTX
0295    00A5            	;MOVWF	TMPX
0296    00A5            
0297    00A5            	;MOVE ON X
0298    00A5    0AA3        INCF    COUNTX,1
0299    00A6    0825    	MOVF  	LIMITX, w
0300    00A7    0223    	SUBWF 	COUNTX,w
0301    00A8    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT < limitx
0302    00A9    28A4    	GOTO 	LOOPX	; JUMP IF COUNT !=  limitx
0303    00AA    20AD    	call	LOOPY ; MOVE Y
0304    00AB            
0305    00AB    20D5    	call 	CLEANX
0306    00AC    0008    	RETURN
0307    00AD            
0308    00AD            LOOPY: ;LOOP i <= LIMITY
0309    00AD    20E3    	call 	EJEY
0310    00AE            
0311    00AE    0822    	MOVFW 	COUNTY
0312    00AF    00AB    	MOVWF	TMPY
0313    00B0            
0314    00B0            	;INSERT LOGIC COMPARE VALUE OF PHOTOCELL & SAVE IT
0315    00B0                ;maybe add a delay here \o/
0316    00B0    2146        call    GET_PHOTOCELL
0317    00B1            
0318    00B1            	;MOVE ON Y
0319    00B1    0AA2        INCF    COUNTY,1
0320    00B2    0824    	MOVF  	LIMITY, w
0321    00B3    0222    	SUBWF 	COUNTY,w
0322    00B4    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT < limity
0323    00B5    28AD    	GOTO 	LOOPY	; JUMP IF COUNT !=  limity
0324    00B6            	;RESET Y
0325    00B6    20D2    	call 	CLEANY
0326    00B7    20B9    	call 	LOOPYREVERSE
0327    00B8    0008    	return
0328    00B9            
0329    00B9            LOOPYREVERSE:
0330    00B9    20E8    	call 	REVERSEEJEY
0331    00BA    0AA2        INCF    COUNTY,1
0332    00BB    0824    	MOVF  	LIMITY, w
0333    00BC    0222    	SUBWF 	COUNTY,w
0334    00BD    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT <32
0335    00BE    28B9    	GOTO 	LOOPYREVERSE
0336    00BF    20D2    	call 	CLEANY
0337    00C0    0008    	RETURN
0338    00C1            
0339    00C1            LOOPXREVERSE:
0340    00C1    20ED    	call 	REVERSEEJEX
0341    00C2    0AA3        INCF    COUNTX,1
0342    00C3    0825    	MOVF  	LIMITX, w
0343    00C4    0223    	SUBWF 	COUNTX,w
0344    00C5    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT <32
0345    00C6    28C1    	GOTO 	LOOPXREVERSE
0346    00C7    20D5    	call 	CLEANX
0347    00C8    0008    	RETURN
0348    00C9            ;-------------------------------------------------------------------
0349    00C9            ;						DELAYS
0350    00C9            Delay ; = 0.0001 seconds
0351    00C9            			;496 cycles
0352    00C9    30A5    	movlw	0xA5
0353    00CA    00A6    	movwf	p1
0354    00CB            Delay_0
0355    00CB    0BA6    	decfsz	p1, f
0356    00CC    28CB    	goto	Delay_0
0357    00CD            
0358    00CD            			;4 cycles (including call)
0359    00CD    0008    	return
0360    00CE            ;-------------------------------------------------------------------
0361    00CE            ;						UTILITIES
0362    00CE            MOVEVALUE:	
0363    00CE    20C9    	call 	DELAY
0364    00CF    0821    	MOVF	DATO, W  
0365    00D0    0086    	MOVWF	PORTB	
0366    00D1    0008    	RETURN
0367    00D2            CLEANY:
0368    00D2    3000    	MOVLW 	0x00  ;se asigna la literal a w (0x00)
0369    00D3    00A2    	MOVWF 	COUNTY ;muevo w a COUNT 
0370    00D4    0008    	RETURN
0371    00D5            CLEANX:
0372    00D5    3000    	MOVLW 	0x00  ;se asigna la literal a w (0x00)
0373    00D6    00A3    	MOVWF 	COUNTX ;muevo w a COUNT 
0374    00D7    0008    	RETURN
0375    00D8            CLEANBETA:
0376    00D8    3000    	MOVLW 	0x00  ;se asigna la literal a w (0x00)
0377    00D9    00A8    	MOVWF 	COUNTBETA ;muevo w a COUNT 
0378    00DA    0008    	RETURN
0379    00DB            CLEANVARPHOTOCELL:
0380    00DB    3000    	MOVLW	0x00
0381    00DC    00AA    	MOVWF	VARPHOTOCELL
0382    00DD    0008    	RETURN
0383    00DE            EJEX:	
0384    00DE    2116    	call	MV12
0385    00DF    2106    	call	MV06
0386    00E0    20FA    	call	MV03
0387    00E1    2112    	call	MV09
0388    00E2    0008    	RETURN
0389    00E3            EJEY:	
0390    00E3    2142    	call	MVY12
0391    00E4    2132    	call	MVY6
0392    00E5    2126    	call	MVY3
0393    00E6    213E    	call	MVY9
0394    00E7    0008    	RETURN
0395    00E8            REVERSEEJEY:
0396    00E8            	;call 	DELAY
0397    00E8    213E    	call	MVY9
0398    00E9    2126    	call	MVY3
0399    00EA    2132    	call	MVY6
0400    00EB    2142    	call	MVY12
0401    00EC    0008    	RETURN
0402    00ED            REVERSEEJEX:
0403    00ED    2112    	call  	MV09
0404    00EE    20FA    	call	MV03
0405    00EF    2106    	call	MV06
0406    00F0    2116    	call	MV12
0407    00F1    0008    	RETURN
0408    00F2            
0409    00F2            MV01:	
0410    00F2    3001    	MOVLW	B'00000001'
0411    00F3    00A1    	MOVWF	DATO
0412    00F4    20CE    	call	MOVEVALUE
0413    00F5    0008    	RETURN
0414    00F6            
0415    00F6            MV02:
0416    00F6    3002    	MOVLW	B'00000010'
0417    00F7    00A1    	MOVWF	DATO
0418    00F8    20CE    	call	MOVEVALUE
0419    00F9    0008    	RETURN
0420    00FA            MV03:	
0421    00FA    3003    	MOVLW	B'00000011'
0422    00FB    00A1    	MOVWF	DATO
0423    00FC    20CE    	call	MOVEVALUE
0424    00FD    0008    	RETURN
0425    00FE            
0426    00FE            MV04:
0427    00FE    3004    	MOVLW	B'00000100'
0428    00FF    00A1    	MOVWF	DATO
0429    0100    20CE    	call	MOVEVALUE
0430    0101    0008    	RETURN
0431    0102            MV05:
0432    0102    3005    	MOVLW	B'00000101'
0433    0103    00A1    	MOVWF	DATO
0434    0104    20CE    	call	MOVEVALUE
0435    0105    0008    	RETURN
0436    0106            MV06:
0437    0106    3006    	MOVLW	B'00000110'
0438    0107    00A1    	MOVWF	DATO
0439    0108    20CE    	call	MOVEVALUE
0440    0109    0008    	RETURN
0441    010A            MV07:
0442    010A    3007    	MOVLW	B'00000111'
0443    010B    00A1    	MOVWF	DATO
0444    010C    20CE    	call	MOVEVALUE
0445    010D    0008    	RETURN
0446    010E            MV08:
0447    010E    3008    	MOVLW	B'00001000'
0448    010F    00A1    	MOVWF	DATO
0449    0110    20CE    	call	MOVEVALUE
0450    0111    0008    	RETURN
0451    0112            MV09:
0452    0112    3009    	MOVLW	B'00001001'
0453    0113    00A1    	MOVWF	DATO
0454    0114    20CE    	call	MOVEVALUE
0455    0115    0008    	RETURN
0456    0116            MV12:
0457    0116    300C    	MOVLW	B'00001100'
0458    0117    00A1    	MOVWF	DATO
0459    0118    20CE    	call	MOVEVALUE
0460    0119    0008    	RETURN
0461    011A            MVy0:
0462    011A    3000    	MOVLW	B'00000000'
0463    011B    00A1    	MOVWF	DATO
0464    011C    20CE    	call	MOVEVALUE
0465    011D    0008    	RETURN
0466    011E            MVY1:
0467    011E    3010    	MOVLW	B'00010000'
0468    011F    00A1    	MOVWF	DATO
0469    0120    20CE    	call	MOVEVALUE
0470    0121    0008    	RETURN
0471    0122            MVY2:
0472    0122    3020    	MOVLW	B'00100000'
0473    0123    00A1    	MOVWF	DATO
0474    0124    20CE    	call	MOVEVALUE
0475    0125    0008    	RETURN
0476    0126            MVY3:
0477    0126    3030    	MOVLW	B'00110000'
0478    0127    00A1    	MOVWF	DATO
0479    0128    20CE    	call	MOVEVALUE
0480    0129    0008    	RETURN
0481    012A            MVY4:
0482    012A    3040    	MOVLW	B'01000000'
0483    012B    00A1    	MOVWF	DATO
0484    012C    20CE    	call	MOVEVALUE
0485    012D    0008    	RETURN
0486    012E            MVY5:
0487    012E    3050    	MOVLW	B'01010000'
0488    012F    00A1    	MOVWF	DATO
0489    0130    20CE    	call	MOVEVALUE
0490    0131    0008    	RETURN
0491    0132            MVY6:
0492    0132    3060    	MOVLW	B'01100000'
0493    0133    00A1    	MOVWF	DATO
0494    0134    20CE    	call	MOVEVALUE
0495    0135    0008    	RETURN
0496    0136            MVY7:
0497    0136    3070    	MOVLW	B'01110000'
0498    0137    00A1    	MOVWF	DATO
0499    0138    20CE    	call	MOVEVALUE
0500    0139    0008    	RETURN
0501    013A            MVY8:
0502    013A    3080    	MOVLW	B'10000000'
0503    013B    00A1    	MOVWF	DATO
0504    013C    20CE    	call	MOVEVALUE
0505    013D    0008    	RETURN
0506    013E            MVY9:
0507    013E    3090    	MOVLW	B'10010000'
0508    013F    00A1    	MOVWF	DATO
0509    0140    20CE    	call	MOVEVALUE
0510    0141    0008    	RETURN
0511    0142            MVY12:
0512    0142    30C0    	MOVLW	B'11000000'
0513    0143    00A1    	MOVWF	DATO
0514    0144    20CE    	call	MOVEVALUE
0515    0145    0008    	RETURN
0516    0146            ;-----------------------------------------------------------------
0517    0146            ;							PHOTOCELL
0518    0146            GET_PHOTOCELL:
0519    0146            _bucle:
0520    0146            	;btfss INTCON,T0IF
0521    0146            	;goto _bucle ;Esperar que el timer0 desborde
0522    0146            	; SE DEBE DE COLOCAR UN DELAY PARA QUE ESPERE LA CONVERSION
0523    0146    1503    	BSF  STATUS,Z
0524    0147    219E    	CALL _PRESPERA
0525    0148    110B    	bcf INTCON,T0IF ;Limpiar el indicador de desborde
0526    0149    151F    	bsf ADCON0,GO ;Comenzar conversion A/D
0527    014A            _espera:
0528    014A    191F    	btfsc ADCON0,GO ;ADCON0 es 0? (la conversion esta completa?)
0529    014B    294A    	goto _espera ;No, ir _espera
0530    014C    081E    	movf ADRESH,W ;Si, W=ADRESH
0531    014D            	; 1Eh ADRESH A/D Result Register High Byte
0532    014D            	; 9Eh ADRESL A/D Result Register Low Byte 
0533    014D    00B8    	movwf ADC ;ADC=W
0534    014E    0838    	movfw ADC ;W = ADC
0535    014F    2952        	goto  V1
0536    0150            returnExec:
0537    0150    207C    	call 	COMPARE
0538    0151    0008    	return
0539    0152            
0540    0152            V1:
0541    0152    30D2        movlw D'210'
0542    0153    0238        subwf ADC, W
0543    0154    1C03        btfss STATUS, C
0544    0155    295A        goto V2
0545    0156    3000        movlw 0x0
0546    0157    00AE        movwf waffles
0547    0158    21AF        call case0
0548    0159    2950        goto returnExec
0549    015A            
0550    015A            V2:
0551    015A    30C2        movlw D'194'
0552    015B    0238        subwf ADC, W
0553    015C    1C03        btfss STATUS, C
0554    015D    2962        goto V3
0555    015E    3001        movlw 0x1
0556    015F    00AE        movwf waffles
0557    0160    21B7        call case1
0558    0161    2950        goto returnExec
0559    0162            
0560    0162            V3:
0561    0162    30AE        movlw D'174'
0562    0163    0238        subwf ADC, W
0563    0164    1C03        btfss STATUS, C
0564    0165    296A        goto V4
0565    0166    3002        movlw 0x2
0566    0167    00AE        movwf waffles
0567    0168    21BF        call case2
0568    0169    2950        goto returnExec
0569    016A            
0570    016A            V4:
0571    016A    309E        movlw D'158'
0572    016B    0238        subwf ADC, W
0573    016C    1C03        btfss STATUS, C
0574    016D    2972        goto V5
0575    016E    3003        movlw 0x3
0576    016F    00AE        movwf waffles
0577    0170    21C7        call case3
0578    0171    2950        goto returnExec
0579    0172            
0580    0172            V5:
0581    0172    308A        movlw D'138'
0582    0173    0238        subwf ADC, W
0583    0174    1C03        btfss STATUS, C
0584    0175    297A        goto V6
0585    0176    3004        movlw 0x4
0586    0177    00AE        movwf waffles
0587    0178    21CF        call case4
0588    0179    2950        goto returnExec
0589    017A            
0590    017A            V6:
0591    017A    3075        movlw D'117'
0592    017B    0238        subwf ADC, W
0593    017C    1C03        btfss STATUS, C
0594    017D    2982        goto V7
0595    017E    3005        movlw 0x5
0596    017F    00AE        movwf waffles
0597    0180    21D7        call case5
0598    0181    2950        goto returnExec
0599    0182            
0600    0182            V7:
0601    0182    3052        movlw D'82'
0602    0183    0238        subwf ADC, W
0603    0184    1C03        btfss STATUS, C
0604    0185    298A        goto V8
0605    0186    3006        movlw 0x6
0606    0187    00AE        movwf waffles
0607    0188    21DF        call case6
0608    0189    2950        goto returnExec
0609    018A            
0610    018A            V8:
0611    018A    3033        movlw D'51'
0612    018B    0238        subwf ADC, W
0613    018C    1C03        btfss STATUS, C
0614    018D    2992        goto V9
0615    018E    3007        movlw 0x7
0616    018F    00AE        movwf waffles
0617    0190    21E7        call case7
0618    0191    2950        goto returnExec
0619    0192            
0620    0192            V9:
0621    0192    301C        movlw D'28'
0622    0193    0238        subwf ADC, W
0623    0194    1C03        btfss STATUS, C
0624    0195    299A        goto V10
0625    0196    3008        movlw 0x8
0626    0197    00AE        movwf waffles
0627    0198    21EF        call case8
0628    0199    2950        goto returnExec
0629    019A            
0630    019A            V10:
0631    019A                ; movlw D'0'
0632    019A                ; subwf ADC, W
0633    019A                ; btfss STATUS, N
0634    019A                ; goto V10<--
0635    019A                ;btfsc STATUS, C
0636    019A    3009        movlw 0x9
0637    019B    00AE        movwf waffles
0638    019C    21F7        call case9
0639    019D    2950        goto returnExec
0640    019E            
0641    019E            _PRESPERA:
0642    019E    30FF    	MOVLW 0XFF
0643    019F    00C0    	MOVWF CounterA
0644    01A0    00BF    	MOVWF COUNTERb
0645    01A1    00BE    	MOVWF COUNTERc	
0646    01A2    21A4    	CALL ESPE
0647    01A3    0008    	RETURN	
0648    01A4            	
0649    01A4            ESPE:
0650    01A4    0BC0    	DECFSZ	CounterA,0X01
0651    01A5    29A4    	GOTO	ESPE
0652    01A6    21A8    	CALL	ESPE2
0653    01A7    0008    	RETURN
0654    01A8            ESPE2:
0655    01A8    0BBF    	DECFSZ	COUNTERb,0X01
0656    01A9    29A8    	GOTO	ESPE2
0657    01AA    21AC    	CALL	ESPE3
0658    01AB    0008    	RETURN
0659    01AC            ESPE3:
0660    01AC    0BBE    	DECFSZ	COUNTERc,0X01
0661    01AD    29AC    	GOTO	ESPE3
0662    01AE    0008    	RETURN	
0663    01AF            
0664    01AF            case0
0665    01AF    1485        bsf PORTA, 1
0666    01B0    1505        bsf PORTA, 2
0667    01B1    1585        bsf PORTA, 3
0668    01B2    1605        bsf PORTA, 4
0669    01B3    1685        bsf PORTA, 5
0670    01B4    1409        bsf PORTE, 0
0671    01B5    1089        bcf PORTE, 1
0672    01B6    0008        return 
0673    01B7            case1
0674    01B7                ;movlw 0x0
0675    01B7    1085        bcf PORTA, 1
0676    01B8    1205        bcf PORTA, 4
0677    01B9    1285        bcf PORTA, 5
0678    01BA    1009        bcf PORTE, 0
0679    01BB    1089        bcf PORTE, 1
0680    01BC                ;movlw 0x1
0681    01BC    1505        bsf PORTA, 2
0682    01BD    1585        bsf PORTA, 3
0683    01BE    0008        return
0684    01BF            case2
0685    01BF                ;movlw 0x1
0686    01BF    1485        bsf PORTA, 1
0687    01C0    1505        bsf PORTA, 2
0688    01C1    1605        bsf PORTA, 4
0689    01C2    1685        bsf PORTA, 5
0690    01C3    1489        bsf PORTE, 1
0691    01C4                ;movlw 0x0
0692    01C4    1185        bcf PORTA, 3
0693    01C5    1009        bcf PORTE, 0
0694    01C6    0008        return
0695    01C7            case3
0696    01C7                ;movlw 0x1
0697    01C7    1485        bsf PORTA, 1
0698    01C8    1505        bsf PORTA, 2
0699    01C9    1585        bsf PORTA, 3
0700    01CA    1605        bsf PORTA, 4
0701    01CB    1489        bsf PORTE, 1
0702    01CC                ;movlw 0x0
0703    01CC    1009        bcf PORTE, 0
0704    01CD    1285        bcf PORTA, 5
0705    01CE    0008        return
0706    01CF            case4
0707    01CF                ;movlw 0x1
0708    01CF    1505        bsf PORTA, 2
0709    01D0    1585        bsf PORTA, 3
0710    01D1    1409        bsf PORTE, 0
0711    01D2    1489        bsf PORTE, 1
0712    01D3                ;movlw 0x0
0713    01D3    1085        bcf PORTA, 1
0714    01D4    1205        bcf PORTA, 4
0715    01D5    1285        bcf PORTA, 5
0716    01D6    0008        return
0717    01D7            case5
0718    01D7                ;movlw 0x1
0719    01D7    1585        bsf PORTA, 3
0720    01D8    1605        bsf PORTA, 4
0721    01D9    1409        bsf PORTE, 0
0722    01DA    1489        bsf PORTE, 1
0723    01DB    1485        bsf PORTA, 1
0724    01DC                ;movlw 0x0
0725    01DC    1285        bcf PORTA, 5
0726    01DD    1105        bcf PORTA, 2
0727    01DE    0008        return
0728    01DF            case6
0729    01DF                ;movlw 0x1
0730    01DF    1585        bsf PORTA, 3
0731    01E0    1605        bsf PORTA, 4
0732    01E1    1685        bsf PORTA, 5
0733    01E2    1409        bsf PORTE, 0
0734    01E3    1489        bsf PORTE, 1
0735    01E4    1485        bsf PORTA, 1
0736    01E5                ;movlw 0x0
0737    01E5    1105        bcf PORTA, 2
0738    01E6    0008        return
0739    01E7            case7
0740    01E7                ;movlw 0x1
0741    01E7    1485        bsf PORTA, 1
0742    01E8    1505        bsf PORTA, 2
0743    01E9    1585        bsf PORTA, 3
0744    01EA                ;movlw 0x0
0745    01EA    1205        bcf PORTA, 4
0746    01EB    1285        bcf PORTA, 5
0747    01EC    1009        bcf PORTE, 0
0748    01ED    1089        bcf PORTE, 1
0749    01EE    0008        return
0750    01EF            case8
0751    01EF                ;movlw 0x1
0752    01EF    1485        bsf PORTA, 1
0753    01F0    1505        bsf PORTA, 2
0754    01F1    1585        bsf PORTA, 3
0755    01F2    1605        bsf PORTA, 4
0756    01F3    1685        bsf PORTA, 5
0757    01F4    1409        bsf PORTE, 0
0758    01F5    1489        bsf PORTE, 1
0759    01F6    0008        return
0760    01F7            case9
0761    01F7                ;movlw 0x1
0762    01F7    1485        bsf PORTA, 1
0763    01F8    1505        bsf PORTA, 2
0764    01F9    1585        bsf PORTA, 3
0765    01FA    1605        bsf PORTA, 4
0766    01FB    1409        bsf PORTE, 0
0767    01FC    1489        bsf PORTE, 1
0768    01FD                ;movlw 0x0
0769    01FD    1285        bcf PORTA, 5
0770    01FE    0008        return
0771    01FF            ;-------------------------------------------------------------
0772    01FF            				;SHOW VALUE OF PHOTOCELL
0773    01FF            SHOWVARDISPLAY: ;show varphotocell on display
0774    01FF    3000     	movlw 0x00
0775    0200    0236        subwf VARDISPLAY, W
0776    0201    1903        BTFSC STATUS, z
0777    0202    2A28        goto  case0d
0778    0203            
0779    0203    3001     	movlw 0x01
0780    0204    0236        subwf VARDISPLAY, W
0781    0205    1903        BTFSC STATUS, z
0782    0206    2A30        goto  case1d
0783    0207            
0784    0207    3002    	movlw 0x02
0785    0208    0236        subwf VARDISPLAY, W
0786    0209    1903        BTFSC STATUS, z
0787    020A    2A38        goto  case2d
0788    020B            
0789    020B    3003     	movlw 0x03
0790    020C    0236        subwf VARDISPLAY, W
0791    020D    1903        BTFSC STATUS, z
0792    020E    2A40        goto  case3d
0793    020F            
0794    020F    3004     	movlw 0x04
0795    0210    0236        subwf VARDISPLAY, W
0796    0211    1903        BTFSC STATUS, z
0797    0212    2A48        goto  case4d
0798    0213            
0799    0213    3005    	movlw 0x05
0800    0214    0236        subwf VARDISPLAY, W
0801    0215    1903        BTFSC STATUS, z
0802    0216    2A50        goto  case5d
0803    0217            
0804    0217    3006     	movlw 0x06
0805    0218    0236        subwf VARDISPLAY, W
0806    0219    1903        BTFSC STATUS, z
0807    021A    2A58        goto  case6d
0808    021B            
0809    021B    3007     	movlw 0x07
0810    021C    0236        subwf VARDISPLAY, W
0811    021D    1903        BTFSC STATUS, z
0812    021E    2A60        goto  case7d
0813    021F            
0814    021F    3008     	movlw 0x08
0815    0220    0236        subwf VARDISPLAY, W
0816    0221    1903        BTFSC STATUS, z
0817    0222    2A68        goto  case8d
0818    0223            
0819    0223    3009     	movlw 0x09
0820    0224    0236        subwf VARDISPLAY, W
0821    0225    1903        BTFSC STATUS, z
0822    0226    2A70        goto  case9d	
0823    0227            endshow:
0824    0227    0008    	RETURN
0825    0228            
0826    0228            case0d
0827    0228    1485        bsf PORTA, 1
0828    0229    1505        bsf PORTA, 2
0829    022A    1585        bsf PORTA, 3
0830    022B    1605        bsf PORTA, 4
0831    022C    1685        bsf PORTA, 5
0832    022D    1409        bsf PORTE, 0
0833    022E    1089        bcf PORTE, 1
0834    022F    2A27        goto	endshow
0835    0230            case1d
0836    0230                ;movlw 0x0
0837    0230    1085        bcf PORTA, 1
0838    0231    1205        bcf PORTA, 4
0839    0232    1285        bcf PORTA, 5
0840    0233    1009        bcf PORTE, 0
0841    0234    1089        bcf PORTE, 1
0842    0235                ;movlw 0x1
0843    0235    1505        bsf PORTA, 2
0844    0236    1585        bsf PORTA, 3
0845    0237    2A27        goto	endshow
0846    0238            case2d
0847    0238                ;movlw 0x1
0848    0238    1485        bsf PORTA, 1
0849    0239    1505        bsf PORTA, 2
0850    023A    1605        bsf PORTA, 4
0851    023B    1685        bsf PORTA, 5
0852    023C    1489        bsf PORTE, 1
0853    023D                ;movlw 0x0
0854    023D    1185        bcf PORTA, 3
0855    023E    1009        bcf PORTE, 0
0856    023F    2A27        goto	endshow
0857    0240            case3d
0858    0240                ;movlw 0x1
0859    0240    1485        bsf PORTA, 1
0860    0241    1505        bsf PORTA, 2
0861    0242    1585        bsf PORTA, 3
0862    0243    1605        bsf PORTA, 4
0863    0244    1489        bsf PORTE, 1
0864    0245                ;movlw 0x0
0865    0245    1009        bcf PORTE, 0
0866    0246    1285        bcf PORTA, 5
0867    0247    2A27        goto	endshow
0868    0248            case4d
0869    0248                ;movlw 0x1
0870    0248    1505        bsf PORTA, 2
0871    0249    1585        bsf PORTA, 3
0872    024A    1409        bsf PORTE, 0
0873    024B    1489        bsf PORTE, 1
0874    024C                ;movlw 0x0
0875    024C    1085        bcf PORTA, 1
0876    024D    1205        bcf PORTA, 4
0877    024E    1285        bcf PORTA, 5
0878    024F    2A27        goto	endshow
0879    0250            case5d
0880    0250                ;movlw 0x1
0881    0250    1585        bsf PORTA, 3
0882    0251    1605        bsf PORTA, 4
0883    0252    1409        bsf PORTE, 0
0884    0253    1489        bsf PORTE, 1
0885    0254    1485        bsf PORTA, 1
0886    0255                ;movlw 0x0
0887    0255    1285        bcf PORTA, 5
0888    0256    1105        bcf PORTA, 2
0889    0257    2A27        goto	endshow
0890    0258            case6d
0891    0258                ;movlw 0x1
0892    0258    1585        bsf PORTA, 3
0893    0259    1605        bsf PORTA, 4
0894    025A    1685        bsf PORTA, 5
0895    025B    1409        bsf PORTE, 0
0896    025C    1489        bsf PORTE, 1
0897    025D    1485        bsf PORTA, 1
0898    025E                ;movlw 0x0
0899    025E    1105        bcf PORTA, 2
0900    025F    2A27        goto	endshow
0901    0260            case7d
0902    0260                ;movlw 0x1
0903    0260    1485        bsf PORTA, 1
0904    0261    1505        bsf PORTA, 2
0905    0262    1585        bsf PORTA, 3
0906    0263                ;movlw 0x0
0907    0263    1205        bcf PORTA, 4
0908    0264    1285        bcf PORTA, 5
0909    0265    1009        bcf PORTE, 0
0910    0266    1089        bcf PORTE, 1
0911    0267    2A27        goto	endshow
0912    0268            case8d
0913    0268                ;movlw 0x1
0914    0268    1485        bsf PORTA, 1
0915    0269    1505        bsf PORTA, 2
0916    026A    1585        bsf PORTA, 3
0917    026B    1605        bsf PORTA, 4
0918    026C    1685        bsf PORTA, 5
0919    026D    1409        bsf PORTE, 0
0920    026E    1489        bsf PORTE, 1
0921    026F    2A27        goto	endshow
0922    0270            case9d
0923    0270                ;movlw 0x1
0924    0270    1485        bsf PORTA, 1
0925    0271    1505        bsf PORTA, 2
0926    0272    1585        bsf PORTA, 3
0927    0273    1605        bsf PORTA, 4
0928    0274    1409        bsf PORTE, 0
0929    0275    1489        bsf PORTE, 1
0930    0276                ;movlw 0x0
0931    0276    1285        bcf PORTA, 5
0932    0277    2A27        goto	endshow
0933    0278            
0934    0278            END
---------------------------------------------
Number of errors = 0
