---------------------------------------------
PIC ASSEMBLER LISTING
Line    Address Opcode  Instruction
---------------------------------------------
0001    0000            TEMP	EQU	0x20
0002    0000            DATO  	EQU 0x21
0003    0000            COUNTY 	EQU 0x22
0004    0000            COUNTX 	EQU 0x23
0005    0000            LIMITY 	EQU 0x24
0006    0000            LIMITX 	EQU 0x25
0007    0000            P1	  	EQU 0x26
0008    0000            P2    	EQU 0x27
0009    0000            COUNTBETA EQU 0x28
0010    0000            LIMITBETA EQU 0x29
0011    0000            
0012    0000            VARPHOTOCELL EQU 0x2A
0013    0000            TMPY    EQU 0x2B
0014    0000            TMPX    EQU 0x2C
0015    0000            TMPBETA EQU 0x2D
0016    0000            waffles	EQU 0x2E
0017    0000            LIMITMAXX   EQU 0x2F
0018    0000            LIMITMAXY   EQU 0x30
0019    0000            LIMITMAXBETA EQU 0x31
0020    0000            
0021    0000            varA    EQU 0x33
0022    0000            varB    EQU 0x34
0023    0000            varC    EQU 0x35
0024    0000            VARDISPLAY  EQU 0x36
0025    0000            cont    EQU 0x37 
0026    0000            ADC     EQU 0x38
0027    0000            CON     EQU 0x39
0028    0000            CON2    EQU 0x3A
0029    0000            CON3    EQU 0x3B
0030    0000            GROUPNUMBER	EQU 0x3C
0031    0000            
0032    0000            CounterC EQU 0x3E
0033    0000            CounterB EQU 0x3F
0034    0000            CounterA EQU 0x40
0035    0000            
0036    0000            INICIO
0037    0000            
0038    0000            	ORG		0x00
0039    0000    2801    	GOTO	START
0040    0001            
0041    0001            START
0042    0001            	;1 = in        0  = out
0043    0001            	;BIT SET FILE
0044    0001    1683    	BSF 	STATUS, 5; COLOCAMOS EN S EL BIT 5 DE REG. ESTATUS
0045    0002    0186    	CLRF	TRISB
0046    0003    0188    	CLRF	TRISD   
0047    0004    1788    	bsf	TRISD, 7
0048    0005    1708    	bsf	TRISD, 6
0049    0006                                ;BIT CLEARE FILE
0050    0006    1283    	BCF		STATUS, RP0 ;TODOS LOS PINES DE B SON SALIDAS
0051    0007            
0052    0007    3000    	MOVLW	0x00
0053    0008    0086    	MOVWF 	PORTB  ; SET 0 TO ALL PORTS B
0054    0009    3000    	MOVLW	0x00
0055    000A    0088    	MOVWF 	PORTD  ; SET 0 TO ALL PORTS B
0056    000B    30E6    	MOVLW 	0xE6        ;NUMBER OF MOVES/STOPS IN Y, E6h = 230d
0057    000C    00A4    	MOVWF 	LIMITY 
0058    000D    00B0    	MOVWF	LIMITMAXY
0059    000E    3020    	MOVLW 	0x20        ;NUMBER OF MOVES IN X
0060    000F    00A5    	MOVWF 	LIMITX 
0061    0010    00AF    	MOVWF	LIMITMAXX
0062    0011    3008    	MOVLW	0x08	    ;NUMBER OF STOPS IN X, 10h = 16d 360grads
0063    0012    00A9    	MOVWF	LIMITBETA
0064    0013    00B1    	MOVWF	LIMITMAXBETA
0065    0014    3006    	MOVLW	0x06			
0066    0015    00BC    	MOVWF	GROUPNUMBER
0067    0016    20E2    	call 	CLEANY      ;SET COUNTERS TO 0
0068    0017    20E5    	call 	CLEANX
0069    0018    20E8    	call 	CLEANBETA
0070    0019    20EB    	call 	CLEANVARPHOTOCELL
0071    001A            
0072    001A            
0073    001A            ;------------------------------------------------------------------------------
0074    001A                            ;CONFIGURATION FOR THE PHOTOCELL 
0075    001A    1283    	bcf STATUS,RP0 ;Ir banco 0
0076    001B    1303    	bcf STATUS,RP1
0077    001C    3041    	movlw b'01000001' ;A/D conversion Fosc/8
0078    001D    009F    	movwf ADCON0
0079    001E            	;     	     7     6     5    4    3    2       1 0
0080    001E            	; 1Fh ADCON0 ADCS1 ADCS0 CHS2 CHS1 CHS0 GO/DONE ? ADON
0081    001E    1683    	bsf STATUS,RP0 ;Ir banco 1
0082    001F    1303    	bcf STATUS,RP1
0083    0020    3007    	movlw b'00000111'
0084    0021    0081    	movwf OPTION_REG ;TMR0 preescaler, 1:156
0085    0022            	;                7    6      5    4    3   2   1   0 
0086    0022            	; 81h OPTION_REG RBPU INTEDG T0CS T0SE PSA PS2 PS1 PS0
0087    0022    300E    	movlw b'00001110' ;A/D Port AN0/RA0
0088    0023    009F    	movwf ADCON1
0089    0024            	;            7    6     5 4 3     2     1     0 
0090    0024            	; 9Fh ADCON1 ADFM ADCS2 ? ? PCFG3 PCFG2 PCFG1 PCFG0
0091    0024    1405    	bsf TRISA,0 ;RA0 linea de entrada para el ADC
0092    0025                	;Port A: display output
0093    0025    1085        	bcf	TRISA, 1
0094    0026    1105       		bcf	TRISA, 2
0095    0027    1185        	bcf	TRISA, 3
0096    0028    1205       		bcf	TRISA, 4
0097    0029    1285        	bcf	TRISA, 5
0098    002A    1009        	bcf	TRISE, 0
0099    002B    1089        	bcf	TRISE, 1
0100    002C    0186    	clrf TRISB
0101    002D    1283    	bcf STATUS,RP0 ;Ir banco 0
0102    002E    1303    	bcf STATUS,RP1
0103    002F            ;--------------------------------------------------------------------
0104    002F            ;--------------------------------------------------------------------
0105    002F            WAITStart:
0106    002F            
0107    002F    1D09        BTFSS	PORTE,2
0108    0030    282F        GOTO    WAITStart
0109    0031            						;MAIN
0110    0031            MAIN:
0111    0031    2040        call    SEARCH      ;SEARCH BEST POINT
0112    0032    204B        call    MOVEGREATER ;GO TO BEST POINT
0113    0033    082A    	MOVFW	VARPHOTOCELL
0114    0034    00B6    	MOVWF	VARDISPLAY
0115    0035    220F    	call	SHOWVARDISPLAY
0116    0036            WAIT:   
0117    0036    1D09        BTFSS	PORTE,2
0118    0037    2836        GOTO    WAIT
0119    0038            
0120    0038            ;poner lo de la comunicacion	
0121    0038            
0122    0038            BUTTONShowGroupNumber:
0123    0038    083C    	MOVFW	GROUPNUMBER
0124    0039    00B6    	MOVWF	VARDISPLAY
0125    003A    220F    	CALL	SHOWVARDISPLAY
0126    003B            
0127    003B    20D3    	call 	BigDelay 
0128    003C    2838    	GOTO	BUTTONShowGroupNumber
0129    003D            
0130    003D            
0131    003D    2056        call    RESTART      ;RETURN TO ORIGINAL POSITION & CLEAN EVERYTHING
0132    003E    282F        GOTO    WAITStart
0133    003F    2A88        GOTO    END
0134    0040            
0135    0040            ;-----------------------------------------------------------------------
0136    0040            ;------------------------------------------------------------------------	
0137    0040            SEARCH:
0138    0040    20A9    	call	LOOPX ; MOVE X AND Y
0139    0041            
0140    0041    0828    	MOVF 	COUNTBETA, W
0141    0042    00AD    	MOVWF	TMPBETA
0142    0043            
0143    0043    0AA8    	INCF	COUNTBETA,1
0144    0044    0829    	MOVF	LIMITBETA, W	
0145    0045    0228    	SUBWF	COUNTBETA, w
0146    0046    1D03    	BTFSS	STATUS,Z
0147    0047    2840    	GOTO	SEARCH
0148    0048    20E8    	call	CLEANBETA   ;CLEAN COUNTBETA
0149    0049    20A1    	call 	LOOPBETAREVERSE    ;RETURN TO ORIGINAL POSITION
0150    004A    0008        RETURN
0151    004B            
0152    004B            ;------------------------------------------------------------------
0153    004B                                    ;MOVE TO GREATER
0154    004B            MOVEGREATER:
0155    004B    2069    	call	LOOPYMAX ; MOVE Y
0156    004C    204E    	call	LOOPXMAXBETA ; MOVE X 
0157    004D            	;call 	LOOPXMAX
0158    004D    0008    	return
0159    004E            LOOPXMAXBETA:
0160    004E    2061    	call 	LOOPXMAX
0161    004F            
0162    004F    0AA8    	INCF	COUNTBETA,1
0163    0050    0831    	MOVF	LIMITMAXBETA, W	
0164    0051    0228    	SUBWF	COUNTBETA, w
0165    0052    1D03    	BTFSS	STATUS,Z
0166    0053    284E    	GOTO	LOOPXMAXBETA
0167    0054    20E8        call	CLEANBETA
0168    0055    0008        RETURN
0169    0056            
0170    0056            RESTART:
0171    0056    205A        call    LOOPMAXBETAREVERSE
0172    0057    2071        call 	LOOPYREVERSEMAX
0173    0058    20EB    	call 	CLEANVARPHOTOCELL
0174    0059    0008        RETURN
0175    005A            
0176    005A            LOOPMAXBETAREVERSE:
0177    005A    2079    	call 	LOOPXREVERSEMAX
0178    005B            	
0179    005B    0AA8    	INCF	COUNTBETA,1
0180    005C    0831    	MOVF	LIMITMAXBETA, W	
0181    005D    0228    	SUBWF	COUNTBETA, w
0182    005E    1D03    	BTFSS	STATUS,Z
0183    005F    285A    	GOTO	LOOPMAXBETAREVERSE
0184    0060    0008        RETURN
0185    0061            
0186    0061            LOOPXMAX:	
0187    0061    20EE    	call 	EJEX
0188    0062            	;MOVE ON X
0189    0062    0AA3        INCF    COUNTX,1
0190    0063    0825    	MOVF  	LIMITX, w
0191    0064    0223    	SUBWF 	COUNTX,w
0192    0065    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT < limitx
0193    0066    2861    	GOTO 	LOOPXMAX	; JUMP IF COUNT !=  limitx
0194    0067    20E5    	call 	CLEANX
0195    0068    0008    	RETURN
0196    0069            
0197    0069            LOOPYMAX:
0198    0069    20F3    	call 	EJEY
0199    006A            	;MOVE ON Y
0200    006A    0AA2        INCF    COUNTY,1 ;count++
0201    006B    0830    	MOVF  	LIMITMAXY, w
0202    006C    0222    	SUBWF 	COUNTY,w
0203    006D    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT < limity
0204    006E    2869    	GOTO 	LOOPYMAX	; JUMP IF COUNT !=  limity
0205    006F            	;RESET  countY
0206    006F    20E2    	call 	CLEANY
0207    0070    0008    	return
0208    0071            
0209    0071            
0210    0071            LOOPYREVERSEMAX:
0211    0071    20F8    	call 	REVERSEEJEY
0212    0072    0AA2        INCF    COUNTY,1
0213    0073    0830    	MOVF  	LIMITMAXY, w
0214    0074    0222    	SUBWF 	COUNTY,w
0215    0075    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT <32
0216    0076    2871    	GOTO 	LOOPYREVERSEMAX
0217    0077    20E2    	call 	CLEANY
0218    0078    0008    	RETURN
0219    0079            
0220    0079            LOOPXREVERSEMAX:
0221    0079    20FD    	call 	REVERSEEJEX
0222    007A    0AA3        INCF    COUNTX,1
0223    007B            	
0224    007B    082F    	MOVF  	LIMITMAXX, w
0225    007C    0223    	SUBWF 	COUNTX,w
0226    007D    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT <32
0227    007E    2879    	GOTO 	LOOPXREVERSEMAX
0228    007F    20E5    	call 	CLEANX
0229    0080    0008    	RETURN
0230    0081            
0231    0081            ;-------------------------------------------------------------------
0232    0081            ;                   Photocell comparation
0233    0081            	;result		carry zero (status)
0234    0081            	;positive     1		0
0235    0081            	;zero		  1		1
0236    0081            	;negative     0     0
0237    0081            COMPARE: ;ASIGNAR A TMPCELL EL NUMERO EN LA ESCALA DE LUZ (0-9)
0238    0081    00AE        MOVWF   Waffles
0239    0082    022A        SUBWF   VARPHOTOCELL, W ; W = VARPHOTOCELL - TMPCELL 
0240    0083    1C03        BTFSS   STATUS, C   ;IF VARPHOTOCELL < TMPCELL ; c=0 if negative
0241    0084    208C        call    CHANGEPHOTOCELL   
0242    0085            	;goto 	DimeElGordito 
0243    0085    0008        return
0244    0086            
0245    0086            SETZERPY:
0246    0086    3001    	MOVLW	0x01
0247    0087    2893    	GOTO	SETy
0248    0088            SETZERPX:
0249    0088    3001    	MOVLW	0x01
0250    0089    2899    	GOTO	SETX
0251    008A            SETZERPBETA:
0252    008A    3001    	MOVLW	0x01
0253    008B    289F    	GOTO	SETBETA
0254    008C            
0255    008C            
0256    008C            CHANGEPHOTOCELL:
0257    008C    082E        MOVFW   waffles 	  ;DATO of Photocell
0258    008D    00AA        MOVWF   VARPHOTOCELL  ;PHOTOCELL =  Waffles
0259    008E            
0260    008E                
0261    008E            	;MOVFW   TMPY
0262    008E    3000    	MOVLW	0x00
0263    008F    022B    	SUBWF	TMPY,W			;TMPY - 0 
0264    0090    1903    	BTFSC	STATUS,Z		;IF TMP == 0
0265    0091    2886    	GOTO 	SETZERPY
0266    0092    082B    	MOVFW   TMPY
0267    0093            SETy:
0268    0093    00B0        MOVWF   LIMITMAXY     ;LIMITMAXY = TMPY
0269    0094            
0270    0094                ;MOVFW   TMPX
0271    0094    3000    	MOVLW	0x00
0272    0095    022C    	SUBWF	TMPX,W
0273    0096    1903    	BTFSC	STATUS,Z
0274    0097    2888    	GOTO	SETZERPX
0275    0098    082C    	MOVFW	TMPX
0276    0099            SETX:
0277    0099    00AF        MOVWF   LIMITMAXX     ;LIMITMAXX = TMPX
0278    009A            
0279    009A               ; MOVFW   TMPBETA
0280    009A    3000       	MOVLW	0x00
0281    009B    022D    	SUBWF	TMPBETA,W
0282    009C    1903    	BTFSC	STATUS,Z
0283    009D    288A    	GOTO	SETZERPBETA
0284    009E    082D    	MOVFW	TMPBETA
0285    009F            SETBETA:
0286    009F    00B1        MOVWF   LIMITMAXBETA  ;LIMITMAXBETA = TMPBETA
0287    00A0    0008        return 
0288    00A1            
0289    00A1            ;---------------------------------------------------------------------
0290    00A1            ;                       LOOPS
0291    00A1            LOOPBETAREVERSE:
0292    00A1    20C6    	call 	LOOPXREVERSE
0293    00A2            	
0294    00A2    0AA8    	INCF	COUNTBETA,1
0295    00A3    0829    	MOVF	LIMITBETA, W	
0296    00A4    0228    	SUBWF	COUNTBETA, w
0297    00A5    1D03    	BTFSS	STATUS,Z
0298    00A6    28A1    	GOTO	LOOPBETAREVERSE
0299    00A7    20E8    	call	CLEANBETA
0300    00A8    0008    	RETURN
0301    00A9            
0302    00A9            LOOPX: ; LOOP i <= LIMITX
0303    00A9    20EE    	call 	EJEX
0304    00AA            
0305    00AA            	;MOVFW 	COUNTX
0306    00AA            	;MOVWF	TMPX
0307    00AA            
0308    00AA            	;MOVE ON X
0309    00AA    0AA3        INCF    COUNTX,1
0310    00AB    0825    	MOVF  	LIMITX, w
0311    00AC    0223    	SUBWF 	COUNTX,w
0312    00AD    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT < limitx
0313    00AE    28A9    	GOTO 	LOOPX	; JUMP IF COUNT !=  limitx
0314    00AF    20B2    	call	LOOPY ; MOVE Y
0315    00B0            
0316    00B0    20E5    	call 	CLEANX
0317    00B1    0008    	RETURN
0318    00B2            
0319    00B2            LOOPY: ;LOOP i <= LIMITY
0320    00B2    20F3    	call 	EJEY
0321    00B3            
0322    00B3    0822    	MOVFW 	COUNTY
0323    00B4    00AB    	MOVWF	TMPY
0324    00B5            
0325    00B5            	;INSERT LOGIC COMPARE VALUE OF PHOTOCELL & SAVE IT
0326    00B5                ;maybe add a delay here \o/
0327    00B5    2156        call    GET_PHOTOCELL
0328    00B6            
0329    00B6            	;MOVE ON Y
0330    00B6    0AA2        INCF    COUNTY,1
0331    00B7    0824    	MOVF  	LIMITY, w
0332    00B8    0222    	SUBWF 	COUNTY,w
0333    00B9    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT < limity
0334    00BA    28B2    	GOTO 	LOOPY	; JUMP IF COUNT !=  limity
0335    00BB            	;RESET Y
0336    00BB    20E2    	call 	CLEANY
0337    00BC    20BE    	call 	LOOPYREVERSE
0338    00BD    0008    	return
0339    00BE            
0340    00BE            LOOPYREVERSE:
0341    00BE    20F8    	call 	REVERSEEJEY
0342    00BF    0AA2        INCF    COUNTY,1
0343    00C0    0824    	MOVF  	LIMITY, w
0344    00C1    0222    	SUBWF 	COUNTY,w
0345    00C2    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT <32
0346    00C3    28BE    	GOTO 	LOOPYREVERSE
0347    00C4    20E2    	call 	CLEANY
0348    00C5    0008    	RETURN
0349    00C6            
0350    00C6            LOOPXREVERSE:
0351    00C6    20FD    	call 	REVERSEEJEX
0352    00C7    0AA3        INCF    COUNTX,1
0353    00C8    0825    	MOVF  	LIMITX, w
0354    00C9    0223    	SUBWF 	COUNTX,w
0355    00CA    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT <32
0356    00CB    28C6    	GOTO 	LOOPXREVERSE
0357    00CC    20E5    	call 	CLEANX
0358    00CD    0008    	RETURN
0359    00CE            ;-------------------------------------------------------------------
0360    00CE            ;						DELAYS
0361    00CE            Delay ; = 0.0001 seconds
0362    00CE            			;496 cycles
0363    00CE    30A5    	movlw	0xA5
0364    00CF    00A6    	movwf	p1
0365    00D0            Delay_0
0366    00D0    0BA6    	decfsz	p1, f
0367    00D1    28D0    	goto	Delay_0
0368    00D2            			;4 cycles (including call)
0369    00D2    0008    	return
0370    00D3            
0371    00D3            BigDelay ; = 0.05 sconds
0372    00D3            			;249993 cycles
0373    00D3    304E    	movlw	0x4E
0374    00D4    00A6    	movwf	p1
0375    00D5    30C4    	movlw	0xC4
0376    00D6    00A7    	movwf	p2
0377    00D7            Delay_1
0378    00D7    0BA6    	decfsz	p1, f
0379    00D8    28DA    	goto	$+2
0380    00D9    0BA7    	decfsz	p2, f
0381    00DA    28D7    	goto	Delay_1
0382    00DB            
0383    00DB            			;3 cycles
0384    00DB    28DC    	goto	$+1
0385    00DC    0000    	nop
0386    00DD            			;4 cycles (including call)
0387    00DD    0008    	return
0388    00DE            ;-------------------------------------------------------------------
0389    00DE            ;						UTILITIES
0390    00DE            MOVEVALUE:	
0391    00DE    20CE    	call 	DELAY
0392    00DF    0821    	MOVF	DATO, W  
0393    00E0    0086    	MOVWF	PORTB	
0394    00E1    0008    	RETURN
0395    00E2            CLEANY:
0396    00E2    3000    	MOVLW 	0x00  ;se asigna la literal a w (0x00)
0397    00E3    00A2    	MOVWF 	COUNTY ;muevo w a COUNT 
0398    00E4    0008    	RETURN
0399    00E5            CLEANX:
0400    00E5    3000    	MOVLW 	0x00  ;se asigna la literal a w (0x00)
0401    00E6    00A3    	MOVWF 	COUNTX ;muevo w a COUNT 
0402    00E7    0008    	RETURN
0403    00E8            CLEANBETA:
0404    00E8    3000    	MOVLW 	0x00  ;se asigna la literal a w (0x00)
0405    00E9    00A8    	MOVWF 	COUNTBETA ;muevo w a COUNT 
0406    00EA    0008    	RETURN
0407    00EB            CLEANVARPHOTOCELL:
0408    00EB    3000    	MOVLW	0x00
0409    00EC    00AA    	MOVWF	VARPHOTOCELL
0410    00ED    0008    	RETURN
0411    00EE            EJEX:	
0412    00EE    2126    	call	MV12
0413    00EF    2116    	call	MV06
0414    00F0    210A    	call	MV03
0415    00F1    2122    	call	MV09
0416    00F2    0008    	RETURN
0417    00F3            EJEY:	
0418    00F3    2152    	call	MVY12
0419    00F4    2142    	call	MVY6
0420    00F5    2136    	call	MVY3
0421    00F6    214E    	call	MVY9
0422    00F7    0008    	RETURN
0423    00F8            REVERSEEJEY:
0424    00F8            	;call 	DELAY
0425    00F8    214E    	call	MVY9
0426    00F9    2136    	call	MVY3
0427    00FA    2142    	call	MVY6
0428    00FB    2152    	call	MVY12
0429    00FC    0008    	RETURN
0430    00FD            REVERSEEJEX:
0431    00FD    2122    	call  	MV09
0432    00FE    210A    	call	MV03
0433    00FF    2116    	call	MV06
0434    0100    2126    	call	MV12
0435    0101    0008    	RETURN
0436    0102            
0437    0102            MV01:	
0438    0102    3001    	MOVLW	B'00000001'
0439    0103    00A1    	MOVWF	DATO
0440    0104    20DE    	call	MOVEVALUE
0441    0105    0008    	RETURN
0442    0106            
0443    0106            MV02:
0444    0106    3002    	MOVLW	B'00000010'
0445    0107    00A1    	MOVWF	DATO
0446    0108    20DE    	call	MOVEVALUE
0447    0109    0008    	RETURN
0448    010A            MV03:	
0449    010A    3003    	MOVLW	B'00000011'
0450    010B    00A1    	MOVWF	DATO
0451    010C    20DE    	call	MOVEVALUE
0452    010D    0008    	RETURN
0453    010E            
0454    010E            MV04:
0455    010E    3004    	MOVLW	B'00000100'
0456    010F    00A1    	MOVWF	DATO
0457    0110    20DE    	call	MOVEVALUE
0458    0111    0008    	RETURN
0459    0112            MV05:
0460    0112    3005    	MOVLW	B'00000101'
0461    0113    00A1    	MOVWF	DATO
0462    0114    20DE    	call	MOVEVALUE
0463    0115    0008    	RETURN
0464    0116            MV06:
0465    0116    3006    	MOVLW	B'00000110'
0466    0117    00A1    	MOVWF	DATO
0467    0118    20DE    	call	MOVEVALUE
0468    0119    0008    	RETURN
0469    011A            MV07:
0470    011A    3007    	MOVLW	B'00000111'
0471    011B    00A1    	MOVWF	DATO
0472    011C    20DE    	call	MOVEVALUE
0473    011D    0008    	RETURN
0474    011E            MV08:
0475    011E    3008    	MOVLW	B'00001000'
0476    011F    00A1    	MOVWF	DATO
0477    0120    20DE    	call	MOVEVALUE
0478    0121    0008    	RETURN
0479    0122            MV09:
0480    0122    3009    	MOVLW	B'00001001'
0481    0123    00A1    	MOVWF	DATO
0482    0124    20DE    	call	MOVEVALUE
0483    0125    0008    	RETURN
0484    0126            MV12:
0485    0126    300C    	MOVLW	B'00001100'
0486    0127    00A1    	MOVWF	DATO
0487    0128    20DE    	call	MOVEVALUE
0488    0129    0008    	RETURN
0489    012A            MVy0:
0490    012A    3000    	MOVLW	B'00000000'
0491    012B    00A1    	MOVWF	DATO
0492    012C    20DE    	call	MOVEVALUE
0493    012D    0008    	RETURN
0494    012E            MVY1:
0495    012E    3010    	MOVLW	B'00010000'
0496    012F    00A1    	MOVWF	DATO
0497    0130    20DE    	call	MOVEVALUE
0498    0131    0008    	RETURN
0499    0132            MVY2:
0500    0132    3020    	MOVLW	B'00100000'
0501    0133    00A1    	MOVWF	DATO
0502    0134    20DE    	call	MOVEVALUE
0503    0135    0008    	RETURN
0504    0136            MVY3:
0505    0136    3030    	MOVLW	B'00110000'
0506    0137    00A1    	MOVWF	DATO
0507    0138    20DE    	call	MOVEVALUE
0508    0139    0008    	RETURN
0509    013A            MVY4:
0510    013A    3040    	MOVLW	B'01000000'
0511    013B    00A1    	MOVWF	DATO
0512    013C    20DE    	call	MOVEVALUE
0513    013D    0008    	RETURN
0514    013E            MVY5:
0515    013E    3050    	MOVLW	B'01010000'
0516    013F    00A1    	MOVWF	DATO
0517    0140    20DE    	call	MOVEVALUE
0518    0141    0008    	RETURN
0519    0142            MVY6:
0520    0142    3060    	MOVLW	B'01100000'
0521    0143    00A1    	MOVWF	DATO
0522    0144    20DE    	call	MOVEVALUE
0523    0145    0008    	RETURN
0524    0146            MVY7:
0525    0146    3070    	MOVLW	B'01110000'
0526    0147    00A1    	MOVWF	DATO
0527    0148    20DE    	call	MOVEVALUE
0528    0149    0008    	RETURN
0529    014A            MVY8:
0530    014A    3080    	MOVLW	B'10000000'
0531    014B    00A1    	MOVWF	DATO
0532    014C    20DE    	call	MOVEVALUE
0533    014D    0008    	RETURN
0534    014E            MVY9:
0535    014E    3090    	MOVLW	B'10010000'
0536    014F    00A1    	MOVWF	DATO
0537    0150    20DE    	call	MOVEVALUE
0538    0151    0008    	RETURN
0539    0152            MVY12:
0540    0152    30C0    	MOVLW	B'11000000'
0541    0153    00A1    	MOVWF	DATO
0542    0154    20DE    	call	MOVEVALUE
0543    0155    0008    	RETURN
0544    0156            ;-----------------------------------------------------------------
0545    0156            ;							PHOTOCELL
0546    0156            GET_PHOTOCELL:
0547    0156            _bucle:
0548    0156            	;btfss INTCON,T0IF
0549    0156            	;goto _bucle ;Esperar que el timer0 desborde
0550    0156            	; SE DEBE DE COLOCAR UN DELAY PARA QUE ESPERE LA CONVERSION
0551    0156    1503    	BSF  STATUS,Z
0552    0157    21AE    	CALL _PRESPERA
0553    0158    110B    	bcf INTCON,T0IF ;Limpiar el indicador de desborde
0554    0159    151F    	bsf ADCON0,GO ;Comenzar conversion A/D
0555    015A            _espera:
0556    015A    191F    	btfsc ADCON0,GO ;ADCON0 es 0? (la conversion esta completa?)
0557    015B    295A    	goto _espera ;No, ir _espera
0558    015C    081E    	movf ADRESH,W ;Si, W=ADRESH
0559    015D            	; 1Eh ADRESH A/D Result Register High Byte
0560    015D            	; 9Eh ADRESL A/D Result Register Low Byte 
0561    015D    00B8    	movwf ADC ;ADC=W
0562    015E    0838    	movfw ADC ;W = ADC
0563    015F    2962        	goto  V1
0564    0160            returnExec:
0565    0160    2081    	call 	COMPARE
0566    0161    0008    	return
0567    0162            
0568    0162            V1:
0569    0162    30D2        movlw D'210'
0570    0163    0238        subwf ADC, W
0571    0164    1C03        btfss STATUS, C
0572    0165    296A        goto V2
0573    0166    3000        movlw 0x0
0574    0167    00AE        movwf waffles
0575    0168    21BF        call case0
0576    0169    2960        goto returnExec
0577    016A            
0578    016A            V2:
0579    016A    30C2        movlw D'194'
0580    016B    0238        subwf ADC, W
0581    016C    1C03        btfss STATUS, C
0582    016D    2972        goto V3
0583    016E    3001        movlw 0x1
0584    016F    00AE        movwf waffles
0585    0170    21C7        call case1
0586    0171    2960        goto returnExec
0587    0172            
0588    0172            V3:
0589    0172    30AE        movlw D'174'
0590    0173    0238        subwf ADC, W
0591    0174    1C03        btfss STATUS, C
0592    0175    297A        goto V4
0593    0176    3002        movlw 0x2
0594    0177    00AE        movwf waffles
0595    0178    21CF        call case2
0596    0179    2960        goto returnExec
0597    017A            
0598    017A            V4:
0599    017A    309E        movlw D'158'
0600    017B    0238        subwf ADC, W
0601    017C    1C03        btfss STATUS, C
0602    017D    2982        goto V5
0603    017E    3003        movlw 0x3
0604    017F    00AE        movwf waffles
0605    0180    21D7        call case3
0606    0181    2960        goto returnExec
0607    0182            
0608    0182            V5:
0609    0182    308A        movlw D'138'
0610    0183    0238        subwf ADC, W
0611    0184    1C03        btfss STATUS, C
0612    0185    298A        goto V6
0613    0186    3004        movlw 0x4
0614    0187    00AE        movwf waffles
0615    0188    21DF        call case4
0616    0189    2960        goto returnExec
0617    018A            
0618    018A            V6:
0619    018A    3075        movlw D'117'
0620    018B    0238        subwf ADC, W
0621    018C    1C03        btfss STATUS, C
0622    018D    2992        goto V7
0623    018E    3005        movlw 0x5
0624    018F    00AE        movwf waffles
0625    0190    21E7        call case5
0626    0191    2960        goto returnExec
0627    0192            
0628    0192            V7:
0629    0192    3052        movlw D'82'
0630    0193    0238        subwf ADC, W
0631    0194    1C03        btfss STATUS, C
0632    0195    299A        goto V8
0633    0196    3006        movlw 0x6
0634    0197    00AE        movwf waffles
0635    0198    21EF        call case6
0636    0199    2960        goto returnExec
0637    019A            
0638    019A            V8:
0639    019A    3033        movlw D'51'
0640    019B    0238        subwf ADC, W
0641    019C    1C03        btfss STATUS, C
0642    019D    29A2        goto V9
0643    019E    3007        movlw 0x7
0644    019F    00AE        movwf waffles
0645    01A0    21F7        call case7
0646    01A1    2960        goto returnExec
0647    01A2            
0648    01A2            V9:
0649    01A2    301C        movlw D'28'
0650    01A3    0238        subwf ADC, W
0651    01A4    1C03        btfss STATUS, C
0652    01A5    29AA        goto V10
0653    01A6    3008        movlw 0x8
0654    01A7    00AE        movwf waffles
0655    01A8    21FF        call case8
0656    01A9    2960        goto returnExec
0657    01AA            
0658    01AA            V10:
0659    01AA                ; movlw D'0'
0660    01AA                ; subwf ADC, W
0661    01AA                ; btfss STATUS, N
0662    01AA                ; goto V10<--
0663    01AA                ;btfsc STATUS, C
0664    01AA    3009        movlw 0x9
0665    01AB    00AE        movwf waffles
0666    01AC    2207        call case9
0667    01AD    2960        goto returnExec
0668    01AE            
0669    01AE            _PRESPERA:
0670    01AE    30FF    	MOVLW 0XFF
0671    01AF    00C0    	MOVWF CounterA
0672    01B0    00BF    	MOVWF COUNTERb
0673    01B1    00BE    	MOVWF COUNTERc	
0674    01B2    21B4    	CALL ESPE
0675    01B3    0008    	RETURN	
0676    01B4            	
0677    01B4            ESPE:
0678    01B4    0BC0    	DECFSZ	CounterA,0X01
0679    01B5    29B4    	GOTO	ESPE
0680    01B6    21B8    	CALL	ESPE2
0681    01B7    0008    	RETURN
0682    01B8            ESPE2:
0683    01B8    0BBF    	DECFSZ	COUNTERb,0X01
0684    01B9    29B8    	GOTO	ESPE2
0685    01BA    21BC    	CALL	ESPE3
0686    01BB    0008    	RETURN
0687    01BC            ESPE3:
0688    01BC    0BBE    	DECFSZ	COUNTERc,0X01
0689    01BD    29BC    	GOTO	ESPE3
0690    01BE    0008    	RETURN	
0691    01BF            
0692    01BF            case0
0693    01BF    1485        bsf PORTA, 1
0694    01C0    1505        bsf PORTA, 2
0695    01C1    1585        bsf PORTA, 3
0696    01C2    1605        bsf PORTA, 4
0697    01C3    1685        bsf PORTA, 5
0698    01C4    1409        bsf PORTE, 0
0699    01C5    1089        bcf PORTE, 1
0700    01C6    0008        return 
0701    01C7            case1
0702    01C7                ;movlw 0x0
0703    01C7    1085        bcf PORTA, 1
0704    01C8    1205        bcf PORTA, 4
0705    01C9    1285        bcf PORTA, 5
0706    01CA    1009        bcf PORTE, 0
0707    01CB    1089        bcf PORTE, 1
0708    01CC                ;movlw 0x1
0709    01CC    1505        bsf PORTA, 2
0710    01CD    1585        bsf PORTA, 3
0711    01CE    0008        return
0712    01CF            case2
0713    01CF                ;movlw 0x1
0714    01CF    1485        bsf PORTA, 1
0715    01D0    1505        bsf PORTA, 2
0716    01D1    1605        bsf PORTA, 4
0717    01D2    1685        bsf PORTA, 5
0718    01D3    1489        bsf PORTE, 1
0719    01D4                ;movlw 0x0
0720    01D4    1185        bcf PORTA, 3
0721    01D5    1009        bcf PORTE, 0
0722    01D6    0008        return
0723    01D7            case3
0724    01D7                ;movlw 0x1
0725    01D7    1485        bsf PORTA, 1
0726    01D8    1505        bsf PORTA, 2
0727    01D9    1585        bsf PORTA, 3
0728    01DA    1605        bsf PORTA, 4
0729    01DB    1489        bsf PORTE, 1
0730    01DC                ;movlw 0x0
0731    01DC    1009        bcf PORTE, 0
0732    01DD    1285        bcf PORTA, 5
0733    01DE    0008        return
0734    01DF            case4
0735    01DF                ;movlw 0x1
0736    01DF    1505        bsf PORTA, 2
0737    01E0    1585        bsf PORTA, 3
0738    01E1    1409        bsf PORTE, 0
0739    01E2    1489        bsf PORTE, 1
0740    01E3                ;movlw 0x0
0741    01E3    1085        bcf PORTA, 1
0742    01E4    1205        bcf PORTA, 4
0743    01E5    1285        bcf PORTA, 5
0744    01E6    0008        return
0745    01E7            case5
0746    01E7                ;movlw 0x1
0747    01E7    1585        bsf PORTA, 3
0748    01E8    1605        bsf PORTA, 4
0749    01E9    1409        bsf PORTE, 0
0750    01EA    1489        bsf PORTE, 1
0751    01EB    1485        bsf PORTA, 1
0752    01EC                ;movlw 0x0
0753    01EC    1285        bcf PORTA, 5
0754    01ED    1105        bcf PORTA, 2
0755    01EE    0008        return
0756    01EF            case6
0757    01EF                ;movlw 0x1
0758    01EF    1585        bsf PORTA, 3
0759    01F0    1605        bsf PORTA, 4
0760    01F1    1685        bsf PORTA, 5
0761    01F2    1409        bsf PORTE, 0
0762    01F3    1489        bsf PORTE, 1
0763    01F4    1485        bsf PORTA, 1
0764    01F5                ;movlw 0x0
0765    01F5    1105        bcf PORTA, 2
0766    01F6    0008        return
0767    01F7            case7
0768    01F7                ;movlw 0x1
0769    01F7    1485        bsf PORTA, 1
0770    01F8    1505        bsf PORTA, 2
0771    01F9    1585        bsf PORTA, 3
0772    01FA                ;movlw 0x0
0773    01FA    1205        bcf PORTA, 4
0774    01FB    1285        bcf PORTA, 5
0775    01FC    1009        bcf PORTE, 0
0776    01FD    1089        bcf PORTE, 1
0777    01FE    0008        return
0778    01FF            case8
0779    01FF                ;movlw 0x1
0780    01FF    1485        bsf PORTA, 1
0781    0200    1505        bsf PORTA, 2
0782    0201    1585        bsf PORTA, 3
0783    0202    1605        bsf PORTA, 4
0784    0203    1685        bsf PORTA, 5
0785    0204    1409        bsf PORTE, 0
0786    0205    1489        bsf PORTE, 1
0787    0206    0008        return
0788    0207            case9
0789    0207                ;movlw 0x1
0790    0207    1485        bsf PORTA, 1
0791    0208    1505        bsf PORTA, 2
0792    0209    1585        bsf PORTA, 3
0793    020A    1605        bsf PORTA, 4
0794    020B    1409        bsf PORTE, 0
0795    020C    1489        bsf PORTE, 1
0796    020D                ;movlw 0x0
0797    020D    1285        bcf PORTA, 5
0798    020E    0008        return
0799    020F            ;-------------------------------------------------------------
0800    020F            				;SHOW VALUE OF PHOTOCELL
0801    020F            SHOWVARDISPLAY: ;show varphotocell on display
0802    020F    3000     	movlw 0x00
0803    0210    0236        subwf VARDISPLAY, W
0804    0211    1903        BTFSC STATUS, z
0805    0212    2A38        goto  case0d
0806    0213            
0807    0213    3001     	movlw 0x01
0808    0214    0236        subwf VARDISPLAY, W
0809    0215    1903        BTFSC STATUS, z
0810    0216    2A40        goto  case1d
0811    0217            
0812    0217    3002    	movlw 0x02
0813    0218    0236        subwf VARDISPLAY, W
0814    0219    1903        BTFSC STATUS, z
0815    021A    2A48        goto  case2d
0816    021B            
0817    021B    3003     	movlw 0x03
0818    021C    0236        subwf VARDISPLAY, W
0819    021D    1903        BTFSC STATUS, z
0820    021E    2A50        goto  case3d
0821    021F            
0822    021F    3004     	movlw 0x04
0823    0220    0236        subwf VARDISPLAY, W
0824    0221    1903        BTFSC STATUS, z
0825    0222    2A58        goto  case4d
0826    0223            
0827    0223    3005    	movlw 0x05
0828    0224    0236        subwf VARDISPLAY, W
0829    0225    1903        BTFSC STATUS, z
0830    0226    2A60        goto  case5d
0831    0227            
0832    0227    3006     	movlw 0x06
0833    0228    0236        subwf VARDISPLAY, W
0834    0229    1903        BTFSC STATUS, z
0835    022A    2A68        goto  case6d
0836    022B            
0837    022B    3007     	movlw 0x07
0838    022C    0236        subwf VARDISPLAY, W
0839    022D    1903        BTFSC STATUS, z
0840    022E    2A70        goto  case7d
0841    022F            
0842    022F    3008     	movlw 0x08
0843    0230    0236        subwf VARDISPLAY, W
0844    0231    1903        BTFSC STATUS, z
0845    0232    2A78        goto  case8d
0846    0233            
0847    0233    3009     	movlw 0x09
0848    0234    0236        subwf VARDISPLAY, W
0849    0235    1903        BTFSC STATUS, z
0850    0236    2A80        goto  case9d	
0851    0237            endshow:
0852    0237    0008    	RETURN
0853    0238            
0854    0238            case0d
0855    0238    1485        bsf PORTA, 1
0856    0239    1505        bsf PORTA, 2
0857    023A    1585        bsf PORTA, 3
0858    023B    1605        bsf PORTA, 4
0859    023C    1685        bsf PORTA, 5
0860    023D    1409        bsf PORTE, 0
0861    023E    1089        bcf PORTE, 1
0862    023F    2A37        goto	endshow
0863    0240            case1d
0864    0240                ;movlw 0x0
0865    0240    1085        bcf PORTA, 1
0866    0241    1205        bcf PORTA, 4
0867    0242    1285        bcf PORTA, 5
0868    0243    1009        bcf PORTE, 0
0869    0244    1089        bcf PORTE, 1
0870    0245                ;movlw 0x1
0871    0245    1505        bsf PORTA, 2
0872    0246    1585        bsf PORTA, 3
0873    0247    2A37        goto	endshow
0874    0248            case2d
0875    0248                ;movlw 0x1
0876    0248    1485        bsf PORTA, 1
0877    0249    1505        bsf PORTA, 2
0878    024A    1605        bsf PORTA, 4
0879    024B    1685        bsf PORTA, 5
0880    024C    1489        bsf PORTE, 1
0881    024D                ;movlw 0x0
0882    024D    1185        bcf PORTA, 3
0883    024E    1009        bcf PORTE, 0
0884    024F    2A37        goto	endshow
0885    0250            case3d
0886    0250                ;movlw 0x1
0887    0250    1485        bsf PORTA, 1
0888    0251    1505        bsf PORTA, 2
0889    0252    1585        bsf PORTA, 3
0890    0253    1605        bsf PORTA, 4
0891    0254    1489        bsf PORTE, 1
0892    0255                ;movlw 0x0
0893    0255    1009        bcf PORTE, 0
0894    0256    1285        bcf PORTA, 5
0895    0257    2A37        goto	endshow
0896    0258            case4d
0897    0258                ;movlw 0x1
0898    0258    1505        bsf PORTA, 2
0899    0259    1585        bsf PORTA, 3
0900    025A    1409        bsf PORTE, 0
0901    025B    1489        bsf PORTE, 1
0902    025C                ;movlw 0x0
0903    025C    1085        bcf PORTA, 1
0904    025D    1205        bcf PORTA, 4
0905    025E    1285        bcf PORTA, 5
0906    025F    2A37        goto	endshow
0907    0260            case5d
0908    0260                ;movlw 0x1
0909    0260    1585        bsf PORTA, 3
0910    0261    1605        bsf PORTA, 4
0911    0262    1409        bsf PORTE, 0
0912    0263    1489        bsf PORTE, 1
0913    0264    1485        bsf PORTA, 1
0914    0265                ;movlw 0x0
0915    0265    1285        bcf PORTA, 5
0916    0266    1105        bcf PORTA, 2
0917    0267    2A37        goto	endshow
0918    0268            case6d
0919    0268                ;movlw 0x1
0920    0268    1585        bsf PORTA, 3
0921    0269    1605        bsf PORTA, 4
0922    026A    1685        bsf PORTA, 5
0923    026B    1409        bsf PORTE, 0
0924    026C    1489        bsf PORTE, 1
0925    026D    1485        bsf PORTA, 1
0926    026E                ;movlw 0x0
0927    026E    1105        bcf PORTA, 2
0928    026F    2A37        goto	endshow
0929    0270            case7d
0930    0270                ;movlw 0x1
0931    0270    1485        bsf PORTA, 1
0932    0271    1505        bsf PORTA, 2
0933    0272    1585        bsf PORTA, 3
0934    0273                ;movlw 0x0
0935    0273    1205        bcf PORTA, 4
0936    0274    1285        bcf PORTA, 5
0937    0275    1009        bcf PORTE, 0
0938    0276    1089        bcf PORTE, 1
0939    0277    2A37        goto	endshow
0940    0278            case8d
0941    0278                ;movlw 0x1
0942    0278    1485        bsf PORTA, 1
0943    0279    1505        bsf PORTA, 2
0944    027A    1585        bsf PORTA, 3
0945    027B    1605        bsf PORTA, 4
0946    027C    1685        bsf PORTA, 5
0947    027D    1409        bsf PORTE, 0
0948    027E    1489        bsf PORTE, 1
0949    027F    2A37        goto	endshow
0950    0280            case9d
0951    0280                ;movlw 0x1
0952    0280    1485        bsf PORTA, 1
0953    0281    1505        bsf PORTA, 2
0954    0282    1585        bsf PORTA, 3
0955    0283    1605        bsf PORTA, 4
0956    0284    1409        bsf PORTE, 0
0957    0285    1489        bsf PORTE, 1
0958    0286                ;movlw 0x0
0959    0286    1285        bcf PORTA, 5
0960    0287    2A37        goto	endshow
0961    0288            
0962    0288            END
---------------------------------------------
Number of errors = 0
