---------------------------------------------
PIC ASSEMBLER LISTING
Line    Address Opcode  Instruction
---------------------------------------------
0001    0000            zTEMP	EQU	0x20
0002    0000            DATO  	EQU 0x21
0003    0000            COUNTY 	EQU 0x22
0004    0000            COUNTX 	EQU 0x23
0005    0000            LIMITY 	EQU 0x24
0006    0000            LIMITX 	EQU 0x25
0007    0000            P1	  	EQU 0x26
0008    0000            P2    	EQU 0x27
0009    0000            COUNTBETA EQU 0x28
0010    0000            LIMITBETA EQU 0x29
0011    0000            
0012    0000            VARPHOTOCELL EQU 0x2A
0013    0000            TMPY    EQU 0x2B
0014    0000            TMPX    EQU 0x2C
0015    0000            TMPBETA EQU 0x2D
0016    0000            waffles	EQU 0x2E
0017    0000            LIMITMAXX   EQU 0x2F
0018    0000            LIMITMAXY   EQU 0x30
0019    0000            LIMITMAXBETA EQU 0x31
0020    0000            
0021    0000            varA    EQU 0x33
0022    0000            varB    EQU 0x34
0023    0000            varC    EQU 0x35
0024    0000            VARDISPLAY  EQU 0x36
0025    0000            cont    EQU 0x37 
0026    0000            ADC     EQU 0x38
0027    0000            CON     EQU 0x39
0028    0000            CON2    EQU 0x3A
0029    0000            CON3    EQU 0x3B
0030    0000            GROUPNUMBER	EQU 0x3C
0031    0000            
0032    0000            CounterC EQU 0x3E
0033    0000            CounterB EQU 0x3F
0034    0000            CounterA EQU 0x40
0035    0000            ;-----------------------------------------
0036    0000            ;DATO 	EQU 0X41
0037    0000            CONR	EQU 0X42
0038    0000            CONE	EQU 0X43
0039    0000            MAYG	EQU 0X44 ; grupo mayor
0040    0000            MAYV	EQU 0X45 ; valor grupo mayor
0041    0000            MENG	EQU 0X46 ; grupo menor
0042    0000            MENV	EQU 0X47 ; valor grupo menor
0043    0000            ;**********valores de backup
0044    0000            MAYBG	EQU 0X48 ; grupo mayor backup
0045    0000            MAYBV	EQU 0X49 ; valor grupo mayor backup
0046    0000            MENBG	EQU 0X4A ; grupo menor backup
0047    0000            MENBV	EQU 0X4B ; valor grupo menor backup
0048    0000            ;****************************
0049    0000            d1	EQU 0X4C
0050    0000            d2	EQU 0X4D
0051    0000            d3	EQU 0X4E
0052    0000            COUNTMENU EQU 0X50
0053    0000            LIMITMENU EQU 0X51
0054    0000            
0055    0000            
0056    0000            INICIO
0057    0000            
0058    0000            	ORG		0x00
0059    0000    2801    	GOTO	START
0060    0001            
0061    0001            START
0062    0001            	;1 = in        0  = out
0063    0001            	;BIT SET FILE
0064    0001    1683    	BSF 	STATUS, 5; COLOCAMOS EN S EL BIT 5 DE REG. ESTATUS
0065    0002    0186    	CLRF	TRISB
0066    0003    0188    	CLRF	TRISD   
0067    0004    1788    	bsf	TRISD, 7
0068    0005    1708    	bsf	TRISD, 6
0069    0006    1488    	bsf	TRISD, 1
0070    0007                                ;BIT CLEARE FILE
0071    0007    1283    	BCF		STATUS, RP0 ;TODOS LOS PINES DE B SON SALIDAS
0072    0008            
0073    0008    3000    	MOVLW	0x00
0074    0009    0086    	MOVWF 	PORTB  ; SET 0 TO ALL PORTS B
0075    000A    3000    	MOVLW	0x00
0076    000B    0088    	MOVWF 	PORTD  ; SET 0 TO ALL PORTS B
0077    000C    30E6    	MOVLW 	0xE6        ;NUMBER OF MOVES/STOPS IN Y, E6h = 230d
0078    000D    00A4    	MOVWF 	LIMITY 
0079    000E    00B0    	MOVWF	LIMITMAXY
0080    000F    3020    	MOVLW 	0x20        ;NUMBER OF MOVES IN X
0081    0010    00A5    	MOVWF 	LIMITX 
0082    0011    00AF    	MOVWF	LIMITMAXX
0083    0012    3008    	MOVLW	0x08	    ;NUMBER OF STOPS IN X, 10h = 16d 360grads
0084    0013    00A9    	MOVWF	LIMITBETA
0085    0014    00B1    	MOVWF	LIMITMAXBETA
0086    0015    3006    	MOVLW	0x06			
0087    0016    00BC    	MOVWF	GROUPNUMBER
0088    0017    3004    	MOVLW   0X04
0089    0018    00D1    	MOVWF 	LIMITMENU
0090    0019    2145    	call 	CLEANY      ;SET COUNTERS TO 0
0091    001A    2148    	call 	CLEANX
0092    001B    214B    	call 	CLEANBETA
0093    001C    214E    	call 	CLEANVARPHOTOCELL
0094    001D            
0095    001D    1683    	BSF	STATUS, 5 
0096    001E            	;BSF	TRISB, 0 ; envï¿½a datos
0097    001E    1708    	BSF	TRISD,6 ;************************
0098    001F            	;BCF	TRISB, 1
0099    001F            	;BCF	TRISB, 2
0100    001F            	;BCF	TRISB, 3
0101    001F            	;BCF	TRISB, 4
0102    001F    1207    	BCF	TRISC, 4 ;************************
0103    0020    1287    	BCF	TRISC, 5 ;************************
0104    0021    1307    	BCF	TRISC, 6 ;************************
0105    0022    1387    	BCF	TRISC, 7 ;************************
0106    0023            
0107    0023            	;BSF	TRISC, 0 ; BIT 0 recibir
0108    0023            	;BSF	TRISC, 1 ; BIT 1 recibir
0109    0023            	;BSF	TRISC, 2 ; BIT 2 recibir
0110    0023            	;BSF	TRISC, 3 ; BIT 3 recibir
0111    0023    1007    	bcf PORTC, 0
0112    0024    1087    	bcf PORTC, 1
0113    0025    1107    	bcf PORTC, 2
0114    0026    1187    	bcf PORTC, 3
0115    0027            	
0116    0027    1408    	BSF	TRISD, 0 ; identifica que tiene que recibir datos
0117    0028    3001    	MOVLW   B'00000001'
0118    0029    00C3    	MOVWF	CONE
0119    002A    00C2    	MOVWF	CONR
0120    002B            
0121    002B    083C    	MOVFW   GROUPNUMBER	
0122    002C    00C4    	MOVWF	MAYG
0123    002D    082A    	MOVFW	VARPHOTOCELL
0124    002E    00C5    	MOVWF	MAYV
0125    002F    083C    	MOVFW   GROUPNUMBER	
0126    0030    00C6    	MOVWF	MENG
0127    0031    082A    	MOVFW	VARPHOTOCELL
0128    0032    00C7    	MOVWF	MENV	
0129    0033            
0130    0033            ;------------------------------------------------------------------------------
0131    0033                            ;CONFIGURATION FOR THE PHOTOCELL 
0132    0033    1283    	bcf STATUS,RP0 ;Ir banco 0
0133    0034    1303    	bcf STATUS,RP1
0134    0035    3041    	movlw b'01000001' ;A/D conversion Fosc/8
0135    0036    009F    	movwf ADCON0
0136    0037            	;     	     7     6     5    4    3    2       1 0
0137    0037            	; 1Fh ADCON0 ADCS1 ADCS0 CHS2 CHS1 CHS0 GO/DONE ? ADON
0138    0037    1683    	bsf STATUS,RP0 ;Ir banco 1
0139    0038    1303    	bcf STATUS,RP1
0140    0039    3007    	movlw b'00000111'
0141    003A    0081    	movwf OPTION_REG ;TMR0 preescaler, 1:156
0142    003B            	;                7    6      5    4    3   2   1   0 
0143    003B            	; 81h OPTION_REG RBPU INTEDG T0CS T0SE PSA PS2 PS1 PS0
0144    003B    300E    	movlw b'00001110' ;A/D Port AN0/RA0
0145    003C    009F    	movwf ADCON1
0146    003D            	;            7    6     5 4 3     2     1     0 
0147    003D            	; 9Fh ADCON1 ADFM ADCS2 ? ? PCFG3 PCFG2 PCFG1 PCFG0
0148    003D    1405    	bsf TRISA,0 ;RA0 linea de entrada para el ADC
0149    003E                	;Port A: display output
0150    003E    1085    	bcf	TRISA, 1
0151    003F    1105    	bcf	TRISA, 2
0152    0040    1185    	bcf	TRISA, 3
0153    0041    1205    	bcf	TRISA, 4
0154    0042    1285    	bcf	TRISA, 5
0155    0043    1009    	bcf	TRISE, 0
0156    0044    1089    	bcf	TRISE, 1
0157    0045    0186    	clrf TRISB
0158    0046    1283    	bcf STATUS,RP0 ;Ir banco 0
0159    0047    1303    	bcf STATUS,RP1
0160    0048            ;--------------------------------------------------------------------
0161    0048            ;--------------------------------------------------------------------
0162    0048            								;MAIN
0163    0048            WAITStart:
0164    0048    1888        BTFSC	PORTD,1
0165    0049    2858        GOTO    MAIN
0166    004A    1909    	BTFSC	PORTE,2
0167    004B    284D    	goto	SEND
0168    004C            	;GOTO	SHOWTHINGS
0169    004C            	;CALL 	COMUNICACION
0170    004C    2848    	GOTO    WAITStart
0171    004D            						
0172    004D            SEND:
0173    004D    082A    	MOVFW	VARPHOTOCELL
0174    004E    00B6    	MOVWF	VARDISPLAY
0175    004F    2275    	call	SHOWVARDISPLAY
0176    0050    1F08    	BTFSS 	PORTD, 6
0177    0051    284D    	GOTO 	SEND
0178    0052            	
0179    0052            SEND2:	
0180    0052    083C    	MOVFW	GROUPNUMBER
0181    0053    00B6    	MOVWF	VARDISPLAY
0182    0054    2275    	CALL	SHOWVARDISPLAY
0183    0055    1D09    	BTFSS	PORTE,2
0184    0056    2852    	GOTO 	SEND2
0185    0057    284D    	GOTO	SEND
0186    0058            
0187    0058            MAIN:
0188    0058    2099        call    SEARCH      ;SEARCH BEST POINT
0189    0059    20A4        call    MOVEGREATER ;GO TO BEST POINT
0190    005A    083C    	MOVFW   GROUPNUMBER	
0191    005B    00C4    	MOVWF	MAYG
0192    005C    082A    	MOVFW	VARPHOTOCELL
0193    005D    00C5    	MOVWF	MAYV
0194    005E    083C    	MOVFW   GROUPNUMBER	
0195    005F    00C6    	MOVWF	MENG
0196    0060    082A    	MOVFW	VARPHOTOCELL
0197    0061    00C7    	MOVWF	MENV	
0198    0062    2875    	GOTO 	SHOWMAX
0199    0063            
0200    0063            SHOWTHINGS:
0201    0063    0AD0    	INCF	COUNTMENU,1
0202    0064    3001    	MOVLW	1	
0203    0065    0250    	SUBWF	COUNTMENU, w
0204    0066    1903    	BTFSC	STATUS,Z
0205    0067    2875    	GOTO	SHOWMAX
0206    0068            
0207    0068    3002    	MOVLW	2	
0208    0069    0250    	SUBWF	COUNTMENU, w
0209    006A    1903    	BTFSC	STATUS,Z
0210    006B    287A    	GOTO 	SHOWMAXGROUP
0211    006C            
0212    006C    3003    	MOVLW	3	
0213    006D    0250    	SUBWF	COUNTMENU, w
0214    006E    1903    	BTFSC	STATUS,Z
0215    006F    287E    	GOTO	SHOWMINGROUP
0216    0070            
0217    0070    3004    	MOVLW	4	
0218    0071    0250    	SUBWF	COUNTMENU, w
0219    0072    1903    	BTFSC	STATUS,Z
0220    0073    2882    	GOTO 	BUTTONShowGroupNumber
0221    0074            
0222    0074    2848    	GOTO 	WAITStart
0223    0075            
0224    0075            
0225    0075            SHOWMAX:
0226    0075    082A    	MOVFW	VARPHOTOCELL
0227    0076    00B6    	MOVWF	VARDISPLAY
0228    0077    2275    	call	SHOWVARDISPLAY
0229    0078              	;call 	BigDelay 
0230    0078    1D09        BTFSS	PORTE,2
0231    0079    2848        GOTO    WAITStart
0232    007A            
0233    007A            SHOWMAXGROUP:
0234    007A    0844    	MOVFW	MAYG
0235    007B    00B6    	MOVWF	VARDISPLAY
0236    007C    2275    	CALL	SHOWVARDISPLAY
0237    007D            	;call 	BigDelay 
0238    007D            	;BTFSS	PORTE,2
0239    007D    2848    	GOTO 	WAITStart
0240    007E            
0241    007E            
0242    007E            SHOWMINGROUP:
0243    007E    0846    	MOVFW	MENG
0244    007F    00B6    	MOVWF	VARDISPLAY
0245    0080    2275    	CALL	SHOWVARDISPLAY	
0246    0081            	;call 	BigDelay 
0247    0081            	;BTFSS	PORTE,2
0248    0081    2848    	GOTO 	WAITStart
0249    0082            
0250    0082            BUTTONShowGroupNumber:
0251    0082    2151    	CALL 	CLEANBUTTONMENU
0252    0083    083C    	MOVFW	GROUPNUMBER
0253    0084    00B6    	MOVWF	VARDISPLAY
0254    0085    2275    	CALL	SHOWVARDISPLAY
0255    0086            
0256    0086            	;call 	BigDelay 
0257    0086            	;BTFSS	PORTE,2
0258    0086            	;GOTO	BUTTONShowGroupNumber
0259    0086    2848    	GOTO 	WAITStart
0260    0087            ;-------------------
0261    0087            		;cOMUNICACION
0262    0087            	;call 	SHOWComun
0263    0087            COMUNICACION:
0264    0087    2137    	CALL	DELAY_D
0265    0088            	;BTFSC   PORTB, 0 ; si el bit de enviar enta encendido va a enviar datos
0266    0088    1B08    	BTFSC   PORTD, 6;*************************
0267    0089    2316    	CALL	ENVIARDEC
0268    008A    2137    	CALL	DELAY_D
0269    008B    1808    	BTFSC	PORTD, 0
0270    008C    2366    	CALL	RECIBIRDEC
0271    008D            
0272    008D    0008    	RETURN
0273    008E            	;EQUIVALENCIAS DE PUERTOS
0274    008E            		;B1 = C4
0275    008E            		;B2 = C5
0276    008E            		;B3 = C6
0277    008E            		;B4 = C7
0278    008E            		;B0 = D6
0279    008E            ;-----------------------
0280    008E            
0281    008E    20AF        call    RESTART      ;RETURN TO ORIGINAL POSITION & CLEAN EVERYTHING
0282    008F    2848        GOTO    WAITStart
0283    0090    2BD8        GOTO    END
0284    0091            
0285    0091            ;-----------------------------------------------------------------------
0286    0091            ;------------------------------------------------------------------------	
0287    0091            SHOWComun:
0288    0091    1485        bsf PORTA, 1
0289    0092    1105        bcf PORTA, 2
0290    0093    1185        bcf PORTA, 3
0291    0094    1605        bsf PORTA, 4
0292    0095    1685        bsf PORTA, 5
0293    0096    1409        bsf PORTE, 0
0294    0097    1089        bcf PORTE, 1
0295    0098    0008    	return
0296    0099            
0297    0099            
0298    0099            SEARCH:
0299    0099    2102    	call	LOOPX ; MOVE X AND Y
0300    009A            
0301    009A    0828    	MOVF 	COUNTBETA, W
0302    009B    00AD    	MOVWF	TMPBETA
0303    009C            
0304    009C    0AA8    	INCF	COUNTBETA,1
0305    009D    0829    	MOVF	LIMITBETA, W	
0306    009E    0228    	SUBWF	COUNTBETA, w
0307    009F    1D03    	BTFSS	STATUS,Z
0308    00A0    2899    	GOTO	SEARCH
0309    00A1    214B    	call	CLEANBETA   ;CLEAN COUNTBETA
0310    00A2    20FA    	call 	LOOPBETAREVERSE    ;RETURN TO ORIGINAL POSITION
0311    00A3    0008        RETURN
0312    00A4            
0313    00A4            ;------------------------------------------------------------------
0314    00A4                                    ;MOVE TO GREATER
0315    00A4            MOVEGREATER:
0316    00A4    20C2    	call	LOOPYMAX ; MOVE Y
0317    00A5    20A7    	call	LOOPXMAXBETA ; MOVE X 
0318    00A6            	;call 	LOOPXMAX
0319    00A6    0008    	return
0320    00A7            LOOPXMAXBETA:
0321    00A7    20BA    	call 	LOOPXMAX
0322    00A8            
0323    00A8    0AA8    	INCF	COUNTBETA,1
0324    00A9    0831    	MOVF	LIMITMAXBETA, W	
0325    00AA    0228    	SUBWF	COUNTBETA, w
0326    00AB    1D03    	BTFSS	STATUS,Z
0327    00AC    28A7    	GOTO	LOOPXMAXBETA
0328    00AD    214B        call	CLEANBETA
0329    00AE    0008        RETURN
0330    00AF            
0331    00AF            RESTART:
0332    00AF    20B3        call    LOOPMAXBETAREVERSE
0333    00B0    20CA        call 	LOOPYREVERSEMAX
0334    00B1    214E    	call 	CLEANVARPHOTOCELL
0335    00B2    0008        RETURN
0336    00B3            
0337    00B3            LOOPMAXBETAREVERSE:
0338    00B3    20D2    	call 	LOOPXREVERSEMAX
0339    00B4            	
0340    00B4    0AA8    	INCF	COUNTBETA,1
0341    00B5    0831    	MOVF	LIMITMAXBETA, W	
0342    00B6    0228    	SUBWF	COUNTBETA, w
0343    00B7    1D03    	BTFSS	STATUS,Z
0344    00B8    28B3    	GOTO	LOOPMAXBETAREVERSE
0345    00B9    0008        RETURN
0346    00BA            
0347    00BA            LOOPXMAX:	
0348    00BA    2154    	call 	EJEX
0349    00BB            	;MOVE ON X
0350    00BB    0AA3        INCF    COUNTX,1
0351    00BC    0825    	MOVF  	LIMITX, w
0352    00BD    0223    	SUBWF 	COUNTX,w
0353    00BE    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT < limitx
0354    00BF    28BA    	GOTO 	LOOPXMAX	; JUMP IF COUNT !=  limitx
0355    00C0    2148    	call 	CLEANX
0356    00C1    0008    	RETURN
0357    00C2            
0358    00C2            LOOPYMAX:
0359    00C2    2159    	call 	EJEY
0360    00C3            	;MOVE ON Y
0361    00C3    0AA2        INCF    COUNTY,1 ;count++
0362    00C4    0830    	MOVF  	LIMITMAXY, w
0363    00C5    0222    	SUBWF 	COUNTY,w
0364    00C6    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT < limity
0365    00C7    28C2    	GOTO 	LOOPYMAX	; JUMP IF COUNT !=  limity
0366    00C8            	;RESET  countY
0367    00C8    2145    	call 	CLEANY
0368    00C9    0008    	return
0369    00CA            
0370    00CA            
0371    00CA            LOOPYREVERSEMAX:
0372    00CA    215E    	call 	REVERSEEJEY
0373    00CB    0AA2        INCF    COUNTY,1
0374    00CC    0830    	MOVF  	LIMITMAXY, w
0375    00CD    0222    	SUBWF 	COUNTY,w
0376    00CE    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT <32
0377    00CF    28CA    	GOTO 	LOOPYREVERSEMAX
0378    00D0    2145    	call 	CLEANY
0379    00D1    0008    	RETURN
0380    00D2            
0381    00D2            LOOPXREVERSEMAX:
0382    00D2    2163    	call 	REVERSEEJEX
0383    00D3    0AA3        INCF    COUNTX,1
0384    00D4            	
0385    00D4    082F    	MOVF  	LIMITMAXX, w
0386    00D5    0223    	SUBWF 	COUNTX,w
0387    00D6    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT <32
0388    00D7    28D2    	GOTO 	LOOPXREVERSEMAX
0389    00D8    2148    	call 	CLEANX
0390    00D9    0008    	RETURN
0391    00DA            
0392    00DA            ;-------------------------------------------------------------------
0393    00DA            ;                   Photocell comparation
0394    00DA            	;result		carry zero (status)
0395    00DA            	;positive     1		0
0396    00DA            	;zero		  1		1
0397    00DA            	;negative     0     0
0398    00DA            COMPARE: ;ASIGNAR A TMPCELL EL NUMERO EN LA ESCALA DE LUZ (0-9)
0399    00DA    00AE        MOVWF   Waffles
0400    00DB    022A        SUBWF   VARPHOTOCELL, W ; W = VARPHOTOCELL - TMPCELL 
0401    00DC    1C03        BTFSS   STATUS, C   ;IF VARPHOTOCELL < TMPCELL ; c=0 if negative
0402    00DD    20E5        call    CHANGEPHOTOCELL   
0403    00DE            	;goto 	DimeElGordito 
0404    00DE    0008        return
0405    00DF            
0406    00DF            SETZERPY:
0407    00DF    3001    	MOVLW	0x01
0408    00E0    28EC    	GOTO	SETy
0409    00E1            SETZERPX:
0410    00E1    3001    	MOVLW	0x01
0411    00E2    28F2    	GOTO	SETX
0412    00E3            SETZERPBETA:
0413    00E3    3001    	MOVLW	0x01
0414    00E4    28F8    	GOTO	SETBETA
0415    00E5            
0416    00E5            
0417    00E5            CHANGEPHOTOCELL:
0418    00E5    082E        MOVFW   waffles 	  ;DATO of Photocell
0419    00E6    00AA        MOVWF   VARPHOTOCELL  ;PHOTOCELL =  Waffles
0420    00E7            
0421    00E7                
0422    00E7            	;MOVFW   TMPY
0423    00E7    3000    	MOVLW	0x00
0424    00E8    022B    	SUBWF	TMPY,W			;TMPY - 0 
0425    00E9    1903    	BTFSC	STATUS,Z		;IF TMP == 0
0426    00EA    28DF    	GOTO 	SETZERPY
0427    00EB    082B    	MOVFW   TMPY
0428    00EC            SETy:
0429    00EC    00B0        MOVWF   LIMITMAXY     ;LIMITMAXY = TMPY
0430    00ED            
0431    00ED                ;MOVFW   TMPX
0432    00ED    3000    	MOVLW	0x00
0433    00EE    022C    	SUBWF	TMPX,W
0434    00EF    1903    	BTFSC	STATUS,Z
0435    00F0    28E1    	GOTO	SETZERPX
0436    00F1    082C    	MOVFW	TMPX
0437    00F2            SETX:
0438    00F2    00AF        MOVWF   LIMITMAXX     ;LIMITMAXX = TMPX
0439    00F3            
0440    00F3               ; MOVFW   TMPBETA
0441    00F3    3000       	MOVLW	0x00
0442    00F4    022D    	SUBWF	TMPBETA,W
0443    00F5    1903    	BTFSC	STATUS,Z
0444    00F6    28E3    	GOTO	SETZERPBETA
0445    00F7    082D    	MOVFW	TMPBETA
0446    00F8            SETBETA:
0447    00F8    00B1        MOVWF   LIMITMAXBETA  ;LIMITMAXBETA = TMPBETA
0448    00F9    0008        return 
0449    00FA            
0450    00FA            ;---------------------------------------------------------------------
0451    00FA            ;                       LOOPS
0452    00FA            LOOPBETAREVERSE:
0453    00FA    211F    	call 	LOOPXREVERSE
0454    00FB            	
0455    00FB    0AA8    	INCF	COUNTBETA,1
0456    00FC    0829    	MOVF	LIMITBETA, W	
0457    00FD    0228    	SUBWF	COUNTBETA, w
0458    00FE    1D03    	BTFSS	STATUS,Z
0459    00FF    28FA    	GOTO	LOOPBETAREVERSE
0460    0100    214B    	call	CLEANBETA
0461    0101    0008    	RETURN
0462    0102            
0463    0102            LOOPX: ; LOOP i <= LIMITX
0464    0102    2154    	call 	EJEX
0465    0103            
0466    0103            	;MOVFW 	COUNTX
0467    0103            	;MOVWF	TMPX
0468    0103            
0469    0103            	;MOVE ON X
0470    0103    0AA3        INCF    COUNTX,1
0471    0104    0825    	MOVF  	LIMITX, w
0472    0105    0223    	SUBWF 	COUNTX,w
0473    0106    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT < limitx
0474    0107    2902    	GOTO 	LOOPX	; JUMP IF COUNT !=  limitx
0475    0108    210B    	call	LOOPY ; MOVE Y
0476    0109            
0477    0109    2148    	call 	CLEANX
0478    010A    0008    	RETURN
0479    010B            
0480    010B            LOOPY: ;LOOP i <= LIMITY
0481    010B    2159    	call 	EJEY
0482    010C            
0483    010C    0822    	MOVFW 	COUNTY
0484    010D    00AB    	MOVWF	TMPY
0485    010E            
0486    010E            	;INSERT LOGIC COMPARE VALUE OF PHOTOCELL & SAVE IT
0487    010E                ;maybe add a delay here \o/
0488    010E    21BC        call    GET_PHOTOCELL
0489    010F            
0490    010F            	;MOVE ON Y
0491    010F    0AA2        INCF    COUNTY,1
0492    0110    0824    	MOVF  	LIMITY, w
0493    0111    0222    	SUBWF 	COUNTY,w
0494    0112    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT < limity
0495    0113    290B    	GOTO 	LOOPY	; JUMP IF COUNT !=  limity
0496    0114            	;RESET Y
0497    0114    2145    	call 	CLEANY
0498    0115    2117    	call 	LOOPYREVERSE
0499    0116    0008    	return
0500    0117            
0501    0117            LOOPYREVERSE:
0502    0117    215E    	call 	REVERSEEJEY
0503    0118    0AA2        INCF    COUNTY,1
0504    0119    0824    	MOVF  	LIMITY, w
0505    011A    0222    	SUBWF 	COUNTY,w
0506    011B    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT <32
0507    011C    2917    	GOTO 	LOOPYREVERSE
0508    011D    2145    	call 	CLEANY
0509    011E    0008    	RETURN
0510    011F            
0511    011F            LOOPXREVERSE:
0512    011F    2163    	call 	REVERSEEJEX
0513    0120    0AA3        INCF    COUNTX,1
0514    0121    0825    	MOVF  	LIMITX, w
0515    0122    0223    	SUBWF 	COUNTX,w
0516    0123    1D03    	BTFSS 	STATUS,Z ;CHECK COUNT <32
0517    0124    291F    	GOTO 	LOOPXREVERSE
0518    0125    2148    	call 	CLEANX
0519    0126    0008    	RETURN
0520    0127            ;-------------------------------------------------------------------
0521    0127            ;						DELAYS
0522    0127            Delay ; = 0.0001 seconds
0523    0127            			;496 cycles
0524    0127    30A5    	movlw	0xA5
0525    0128    00A6    	movwf	p1
0526    0129            Delay_0
0527    0129    0BA6    	decfsz	p1, f
0528    012A    2929    	goto	Delay_0
0529    012B            			;4 cycles (including call)
0530    012B    0008    	return
0531    012C            
0532    012C            BigDelay ; = 0.05 sconds
0533    012C            			;249993 cycles
0534    012C    304E    	movlw	0x4E
0535    012D    00A6    	movwf	p1
0536    012E    30C4    	movlw	0xC4
0537    012F    00A7    	movwf	p2
0538    0130            Delay_1
0539    0130    0BA6    	decfsz	p1, f
0540    0131    2933    	goto	$+2
0541    0132    0BA7    	decfsz	p2, f
0542    0133    2930    	goto	Delay_1
0543    0134            
0544    0134            			;3 cycles
0545    0134    2935    	goto	$+1
0546    0135    0000    	nop
0547    0136            			;4 cycles (including call)
0548    0136    0008    	return
0549    0137            
0550    0137            DELAY_D
0551    0137    3087    	movlw	0x87
0552    0138    00CC    	movwf	d1
0553    0139    3014    	movlw	0x14
0554    013A    00CD    	movwf	d2
0555    013B            DELAY_D_0
0556    013B    0BCC    	decfsz	d1, f
0557    013C    293E    	goto	$+2
0558    013D    0BCD    	decfsz	d2, f
0559    013E    293B    	goto	DELAY_D_0
0560    013F            
0561    013F            			;2 cycles
0562    013F    2940    	goto	$+1
0563    0140    0008    	RETURN
0564    0141            ;-------------------------------------------------------------------
0565    0141            ;						UTILITIES
0566    0141            MOVEVALUE:	
0567    0141    2127    	call 	DELAY
0568    0142    0821    	MOVF	DATO, W  
0569    0143    0086    	MOVWF	PORTB	
0570    0144    0008    	RETURN
0571    0145            CLEANY:
0572    0145    3000    	MOVLW 	0x00  ;se asigna la literal a w (0x00)
0573    0146    00A2    	MOVWF 	COUNTY ;muevo w a COUNT 
0574    0147    0008    	RETURN
0575    0148            CLEANX:
0576    0148    3000    	MOVLW 	0x00  ;se asigna la literal a w (0x00)
0577    0149    00A3    	MOVWF 	COUNTX ;muevo w a COUNT 
0578    014A    0008    	RETURN
0579    014B            CLEANBETA:
0580    014B    3000    	MOVLW 	0x00  ;se asigna la literal a w (0x00)
0581    014C    00A8    	MOVWF 	COUNTBETA ;muevo w a COUNT 
0582    014D    0008    	RETURN
0583    014E            CLEANVARPHOTOCELL:
0584    014E    3000    	MOVLW	0x00
0585    014F    00AA    	MOVWF	VARPHOTOCELL
0586    0150    0008    	RETURN
0587    0151            CLEANBUTTONMENU:
0588    0151    3000    	MOVLW	0x00
0589    0152    00D0    	MOVWF COUNTMENU
0590    0153    0008    	RETURN
0591    0154            
0592    0154            EJEX:	
0593    0154    218C    	call	MV12
0594    0155    217C    	call	MV06
0595    0156    2170    	call	MV03
0596    0157    2188    	call	MV09
0597    0158    0008    	RETURN
0598    0159            EJEY:	
0599    0159    21B8    	call	MVY12
0600    015A    21A8    	call	MVY6
0601    015B    219C    	call	MVY3
0602    015C    21B4    	call	MVY9
0603    015D    0008    	RETURN
0604    015E            REVERSEEJEY:
0605    015E            	;call 	DELAY
0606    015E    21B4    	call	MVY9
0607    015F    219C    	call	MVY3
0608    0160    21A8    	call	MVY6
0609    0161    21B8    	call	MVY12
0610    0162    0008    	RETURN
0611    0163            REVERSEEJEX:
0612    0163    2188    	call  	MV09
0613    0164    2170    	call	MV03
0614    0165    217C    	call	MV06
0615    0166    218C    	call	MV12
0616    0167    0008    	RETURN
0617    0168            
0618    0168            MV01:	
0619    0168    3001    	MOVLW	B'00000001'
0620    0169    00A1    	MOVWF	DATO
0621    016A    2141    	call	MOVEVALUE
0622    016B    0008    	RETURN
0623    016C            
0624    016C            MV02:
0625    016C    3002    	MOVLW	B'00000010'
0626    016D    00A1    	MOVWF	DATO
0627    016E    2141    	call	MOVEVALUE
0628    016F    0008    	RETURN
0629    0170            MV03:	
0630    0170    3003    	MOVLW	B'00000011'
0631    0171    00A1    	MOVWF	DATO
0632    0172    2141    	call	MOVEVALUE
0633    0173    0008    	RETURN
0634    0174            
0635    0174            MV04:
0636    0174    3004    	MOVLW	B'00000100'
0637    0175    00A1    	MOVWF	DATO
0638    0176    2141    	call	MOVEVALUE
0639    0177    0008    	RETURN
0640    0178            MV05:
0641    0178    3005    	MOVLW	B'00000101'
0642    0179    00A1    	MOVWF	DATO
0643    017A    2141    	call	MOVEVALUE
0644    017B    0008    	RETURN
0645    017C            MV06:
0646    017C    3006    	MOVLW	B'00000110'
0647    017D    00A1    	MOVWF	DATO
0648    017E    2141    	call	MOVEVALUE
0649    017F    0008    	RETURN
0650    0180            MV07:
0651    0180    3007    	MOVLW	B'00000111'
0652    0181    00A1    	MOVWF	DATO
0653    0182    2141    	call	MOVEVALUE
0654    0183    0008    	RETURN
0655    0184            MV08:
0656    0184    3008    	MOVLW	B'00001000'
0657    0185    00A1    	MOVWF	DATO
0658    0186    2141    	call	MOVEVALUE
0659    0187    0008    	RETURN
0660    0188            MV09:
0661    0188    3009    	MOVLW	B'00001001'
0662    0189    00A1    	MOVWF	DATO
0663    018A    2141    	call	MOVEVALUE
0664    018B    0008    	RETURN
0665    018C            MV12:
0666    018C    300C    	MOVLW	B'00001100'
0667    018D    00A1    	MOVWF	DATO
0668    018E    2141    	call	MOVEVALUE
0669    018F    0008    	RETURN
0670    0190            MVy0:
0671    0190    3000    	MOVLW	B'00000000'
0672    0191    00A1    	MOVWF	DATO
0673    0192    2141    	call	MOVEVALUE
0674    0193    0008    	RETURN
0675    0194            MVY1:
0676    0194    3010    	MOVLW	B'00010000'
0677    0195    00A1    	MOVWF	DATO
0678    0196    2141    	call	MOVEVALUE
0679    0197    0008    	RETURN
0680    0198            MVY2:
0681    0198    3020    	MOVLW	B'00100000'
0682    0199    00A1    	MOVWF	DATO
0683    019A    2141    	call	MOVEVALUE
0684    019B    0008    	RETURN
0685    019C            MVY3:
0686    019C    3030    	MOVLW	B'00110000'
0687    019D    00A1    	MOVWF	DATO
0688    019E    2141    	call	MOVEVALUE
0689    019F    0008    	RETURN
0690    01A0            MVY4:
0691    01A0    3040    	MOVLW	B'01000000'
0692    01A1    00A1    	MOVWF	DATO
0693    01A2    2141    	call	MOVEVALUE
0694    01A3    0008    	RETURN
0695    01A4            MVY5:
0696    01A4    3050    	MOVLW	B'01010000'
0697    01A5    00A1    	MOVWF	DATO
0698    01A6    2141    	call	MOVEVALUE
0699    01A7    0008    	RETURN
0700    01A8            MVY6:
0701    01A8    3060    	MOVLW	B'01100000'
0702    01A9    00A1    	MOVWF	DATO
0703    01AA    2141    	call	MOVEVALUE
0704    01AB    0008    	RETURN
0705    01AC            MVY7:
0706    01AC    3070    	MOVLW	B'01110000'
0707    01AD    00A1    	MOVWF	DATO
0708    01AE    2141    	call	MOVEVALUE
0709    01AF    0008    	RETURN
0710    01B0            MVY8:
0711    01B0    3080    	MOVLW	B'10000000'
0712    01B1    00A1    	MOVWF	DATO
0713    01B2    2141    	call	MOVEVALUE
0714    01B3    0008    	RETURN
0715    01B4            MVY9:
0716    01B4    3090    	MOVLW	B'10010000'
0717    01B5    00A1    	MOVWF	DATO
0718    01B6    2141    	call	MOVEVALUE
0719    01B7    0008    	RETURN
0720    01B8            MVY12:
0721    01B8    30C0    	MOVLW	B'11000000'
0722    01B9    00A1    	MOVWF	DATO
0723    01BA    2141    	call	MOVEVALUE
0724    01BB    0008    	RETURN
0725    01BC            ;-----------------------------------------------------------------
0726    01BC            ;							PHOTOCELL
0727    01BC            GET_PHOTOCELL:
0728    01BC            _bucle:
0729    01BC            	;btfss INTCON,T0IF
0730    01BC            	;goto _bucle ;Esperar que el timer0 desborde
0731    01BC            	; SE DEBE DE COLOCAR UN DELAY PARA QUE ESPERE LA CONVERSION
0732    01BC    1503    	BSF  STATUS,Z
0733    01BD    2214    	CALL _PRESPERA
0734    01BE    110B    	bcf INTCON,T0IF ;Limpiar el indicador de desborde
0735    01BF    151F    	bsf ADCON0,GO ;Comenzar conversion A/D
0736    01C0            _espera:
0737    01C0    191F    	btfsc ADCON0,GO ;ADCON0 es 0? (la conversion esta completa?)
0738    01C1    29C0    	goto _espera ;No, ir _espera
0739    01C2    081E    	movf ADRESH,W ;Si, W=ADRESH
0740    01C3            	; 1Eh ADRESH A/D Result Register High Byte
0741    01C3            	; 9Eh ADRESL A/D Result Register Low Byte 
0742    01C3    00B8    	movwf ADC ;ADC=W
0743    01C4    0838    	movfw ADC ;W = ADC
0744    01C5    29C8        	goto  V1
0745    01C6            returnExec:
0746    01C6    20DA    	call 	COMPARE
0747    01C7    0008    	return
0748    01C8            
0749    01C8            V1:
0750    01C8    30D2        movlw D'210'
0751    01C9    0238        subwf ADC, W
0752    01CA    1C03        btfss STATUS, C
0753    01CB    29D0        goto V2
0754    01CC    3000        movlw 0x0
0755    01CD    00AE        movwf waffles
0756    01CE    2225        call case0
0757    01CF    29C6        goto returnExec
0758    01D0            
0759    01D0            V2:
0760    01D0    30C2        movlw D'194'
0761    01D1    0238        subwf ADC, W
0762    01D2    1C03        btfss STATUS, C
0763    01D3    29D8        goto V3
0764    01D4    3001        movlw 0x1
0765    01D5    00AE        movwf waffles
0766    01D6    222D        call case1
0767    01D7    29C6        goto returnExec
0768    01D8            
0769    01D8            V3:
0770    01D8    30AE        movlw D'174'
0771    01D9    0238        subwf ADC, W
0772    01DA    1C03        btfss STATUS, C
0773    01DB    29E0        goto V4
0774    01DC    3002        movlw 0x2
0775    01DD    00AE        movwf waffles
0776    01DE    2235        call case2
0777    01DF    29C6        goto returnExec
0778    01E0            
0779    01E0            V4:
0780    01E0    309E        movlw D'158'
0781    01E1    0238        subwf ADC, W
0782    01E2    1C03        btfss STATUS, C
0783    01E3    29E8        goto V5
0784    01E4    3003        movlw 0x3
0785    01E5    00AE        movwf waffles
0786    01E6    223D        call case3
0787    01E7    29C6        goto returnExec
0788    01E8            
0789    01E8            V5:
0790    01E8    308A        movlw D'138'
0791    01E9    0238        subwf ADC, W
0792    01EA    1C03        btfss STATUS, C
0793    01EB    29F0        goto V6
0794    01EC    3004        movlw 0x4
0795    01ED    00AE        movwf waffles
0796    01EE    2245        call case4
0797    01EF    29C6        goto returnExec
0798    01F0            
0799    01F0            V6:
0800    01F0    3075        movlw D'117'
0801    01F1    0238        subwf ADC, W
0802    01F2    1C03        btfss STATUS, C
0803    01F3    29F8        goto V7
0804    01F4    3005        movlw 0x5
0805    01F5    00AE        movwf waffles
0806    01F6    224D        call case5
0807    01F7    29C6        goto returnExec
0808    01F8            
0809    01F8            V7:
0810    01F8    3052        movlw D'82'
0811    01F9    0238        subwf ADC, W
0812    01FA    1C03        btfss STATUS, C
0813    01FB    2A00        goto V8
0814    01FC    3006        movlw 0x6
0815    01FD    00AE        movwf waffles
0816    01FE    2255        call case6
0817    01FF    29C6        goto returnExec
0818    0200            
0819    0200            V8:
0820    0200    3033        movlw D'51'
0821    0201    0238        subwf ADC, W
0822    0202    1C03        btfss STATUS, C
0823    0203    2A08        goto V9
0824    0204    3007        movlw 0x7
0825    0205    00AE        movwf waffles
0826    0206    225D        call case7
0827    0207    29C6        goto returnExec
0828    0208            
0829    0208            V9:
0830    0208    301C        movlw D'28'
0831    0209    0238        subwf ADC, W
0832    020A    1C03        btfss STATUS, C
0833    020B    2A10        goto V10
0834    020C    3008        movlw 0x8
0835    020D    00AE        movwf waffles
0836    020E    2265        call case8
0837    020F    29C6        goto returnExec
0838    0210            
0839    0210            V10:
0840    0210                ; movlw D'0'
0841    0210                ; subwf ADC, W
0842    0210                ; btfss STATUS, N
0843    0210                ; goto V10<--
0844    0210                ;btfsc STATUS, C
0845    0210    3009        movlw 0x9
0846    0211    00AE        movwf waffles
0847    0212    226D        call case9
0848    0213    29C6        goto returnExec
0849    0214            
0850    0214            _PRESPERA:
0851    0214    30FF    	MOVLW 0XFF
0852    0215    00C0    	MOVWF CounterA
0853    0216    00BF    	MOVWF COUNTERb
0854    0217    00BE    	MOVWF COUNTERc	
0855    0218    221A    	CALL ESPE
0856    0219    0008    	RETURN	
0857    021A            	
0858    021A            ESPE:
0859    021A    0BC0    	DECFSZ	CounterA,0X01
0860    021B    2A1A    	GOTO	ESPE
0861    021C    221E    	CALL	ESPE2
0862    021D    0008    	RETURN
0863    021E            ESPE2:
0864    021E    0BBF    	DECFSZ	COUNTERb,0X01
0865    021F    2A1E    	GOTO	ESPE2
0866    0220    2222    	CALL	ESPE3
0867    0221    0008    	RETURN
0868    0222            ESPE3:
0869    0222    0BBE    	DECFSZ	COUNTERc,0X01
0870    0223    2A22    	GOTO	ESPE3
0871    0224    0008    	RETURN	
0872    0225            
0873    0225            case0
0874    0225    1485        bsf PORTA, 1
0875    0226    1505        bsf PORTA, 2
0876    0227    1585        bsf PORTA, 3
0877    0228    1605        bsf PORTA, 4
0878    0229    1685        bsf PORTA, 5
0879    022A    1409        bsf PORTE, 0
0880    022B    1089        bcf PORTE, 1
0881    022C    0008        return 
0882    022D            case1
0883    022D                ;movlw 0x0
0884    022D    1085        bcf PORTA, 1
0885    022E    1205        bcf PORTA, 4
0886    022F    1285        bcf PORTA, 5
0887    0230    1009        bcf PORTE, 0
0888    0231    1089        bcf PORTE, 1
0889    0232                ;movlw 0x1
0890    0232    1505        bsf PORTA, 2
0891    0233    1585        bsf PORTA, 3
0892    0234    0008        return
0893    0235            case2
0894    0235                ;movlw 0x1
0895    0235    1485        bsf PORTA, 1
0896    0236    1505        bsf PORTA, 2
0897    0237    1605        bsf PORTA, 4
0898    0238    1685        bsf PORTA, 5
0899    0239    1489        bsf PORTE, 1
0900    023A                ;movlw 0x0
0901    023A    1185        bcf PORTA, 3
0902    023B    1009        bcf PORTE, 0
0903    023C    0008        return
0904    023D            case3
0905    023D                ;movlw 0x1
0906    023D    1485        bsf PORTA, 1
0907    023E    1505        bsf PORTA, 2
0908    023F    1585        bsf PORTA, 3
0909    0240    1605        bsf PORTA, 4
0910    0241    1489        bsf PORTE, 1
0911    0242                ;movlw 0x0
0912    0242    1009        bcf PORTE, 0
0913    0243    1285        bcf PORTA, 5
0914    0244    0008        return
0915    0245            case4
0916    0245                ;movlw 0x1
0917    0245    1505        bsf PORTA, 2
0918    0246    1585        bsf PORTA, 3
0919    0247    1409        bsf PORTE, 0
0920    0248    1489        bsf PORTE, 1
0921    0249                ;movlw 0x0
0922    0249    1085        bcf PORTA, 1
0923    024A    1205        bcf PORTA, 4
0924    024B    1285        bcf PORTA, 5
0925    024C    0008        return
0926    024D            case5
0927    024D                ;movlw 0x1
0928    024D    1585        bsf PORTA, 3
0929    024E    1605        bsf PORTA, 4
0930    024F    1409        bsf PORTE, 0
0931    0250    1489        bsf PORTE, 1
0932    0251    1485        bsf PORTA, 1
0933    0252                ;movlw 0x0
0934    0252    1285        bcf PORTA, 5
0935    0253    1105        bcf PORTA, 2
0936    0254    0008        return
0937    0255            case6
0938    0255                ;movlw 0x1
0939    0255    1585        bsf PORTA, 3
0940    0256    1605        bsf PORTA, 4
0941    0257    1685        bsf PORTA, 5
0942    0258    1409        bsf PORTE, 0
0943    0259    1489        bsf PORTE, 1
0944    025A    1485        bsf PORTA, 1
0945    025B                ;movlw 0x0
0946    025B    1105        bcf PORTA, 2
0947    025C    0008        return
0948    025D            case7
0949    025D                ;movlw 0x1
0950    025D    1485        bsf PORTA, 1
0951    025E    1505        bsf PORTA, 2
0952    025F    1585        bsf PORTA, 3
0953    0260                ;movlw 0x0
0954    0260    1205        bcf PORTA, 4
0955    0261    1285        bcf PORTA, 5
0956    0262    1009        bcf PORTE, 0
0957    0263    1089        bcf PORTE, 1
0958    0264    0008        return
0959    0265            case8
0960    0265                ;movlw 0x1
0961    0265    1485        bsf PORTA, 1
0962    0266    1505        bsf PORTA, 2
0963    0267    1585        bsf PORTA, 3
0964    0268    1605        bsf PORTA, 4
0965    0269    1685        bsf PORTA, 5
0966    026A    1409        bsf PORTE, 0
0967    026B    1489        bsf PORTE, 1
0968    026C    0008        return
0969    026D            case9
0970    026D                ;movlw 0x1
0971    026D    1485        bsf PORTA, 1
0972    026E    1505        bsf PORTA, 2
0973    026F    1585        bsf PORTA, 3
0974    0270    1605        bsf PORTA, 4
0975    0271    1409        bsf PORTE, 0
0976    0272    1489        bsf PORTE, 1
0977    0273                ;movlw 0x0
0978    0273    1285        bcf PORTA, 5
0979    0274    0008        return
0980    0275            ;-------------------------------------------------------------
0981    0275            				;SHOW VALUE OF PHOTOCELL
0982    0275            SHOWVARDISPLAY: ;show varphotocell on display
0983    0275    3000     	movlw 0x00
0984    0276    0236        subwf VARDISPLAY, W
0985    0277    1903        BTFSC STATUS, z
0986    0278    2A9E        goto  case0d
0987    0279            
0988    0279    3001     	movlw 0x01
0989    027A    0236        subwf VARDISPLAY, W
0990    027B    1903        BTFSC STATUS, z
0991    027C    2AAA        goto  case1d
0992    027D            
0993    027D    3002    	movlw 0x02
0994    027E    0236        subwf VARDISPLAY, W
0995    027F    1903        BTFSC STATUS, z
0996    0280    2AB6        goto  case2d
0997    0281            
0998    0281    3003     	movlw 0x03
0999    0282    0236        subwf VARDISPLAY, W
1000    0283    1903        BTFSC STATUS, z
1001    0284    2AC2        goto  case3d
1002    0285            
1003    0285    3004     	movlw 0x04
1004    0286    0236        subwf VARDISPLAY, W
1005    0287    1903        BTFSC STATUS, z
1006    0288    2ACE        goto  case4d
1007    0289            
1008    0289    3005    	movlw 0x05
1009    028A    0236        subwf VARDISPLAY, W
1010    028B    1903        BTFSC STATUS, z
1011    028C    2ADA        goto  case5d
1012    028D            
1013    028D    3006     	movlw 0x06
1014    028E    0236        subwf VARDISPLAY, W
1015    028F    1903        BTFSC STATUS, z
1016    0290    2AE6        goto  case6d
1017    0291            
1018    0291    3007     	movlw 0x07
1019    0292    0236        subwf VARDISPLAY, W
1020    0293    1903        BTFSC STATUS, z
1021    0294    2AF2        goto  case7d
1022    0295            
1023    0295    3008     	movlw 0x08
1024    0296    0236        subwf VARDISPLAY, W
1025    0297    1903        BTFSC STATUS, z
1026    0298    2AFE        goto  case8d
1027    0299            
1028    0299    3009     	movlw 0x09
1029    029A    0236        subwf VARDISPLAY, W
1030    029B    1903        BTFSC STATUS, z
1031    029C    2B0A        goto  case9d	
1032    029D            endshow:
1033    029D    0008    	RETURN
1034    029E            
1035    029E            case0d
1036    029E    1485        bsf PORTA, 1
1037    029F    1505        bsf PORTA, 2
1038    02A0    1585        bsf PORTA, 3
1039    02A1    1605        bsf PORTA, 4
1040    02A2    1685        bsf PORTA, 5
1041    02A3    1409        bsf PORTE, 0
1042    02A4    1089        bcf PORTE, 1
1043    02A5            
1044    02A5    1007    	bcf PORTC, 0
1045    02A6    1087    	bcf PORTC, 1
1046    02A7    1107    	bcf PORTC, 2
1047    02A8    1187    	bcf PORTC, 3
1048    02A9    2A9D        goto	endshow
1049    02AA            case1d
1050    02AA    1085        bcf PORTA, 1
1051    02AB    1205        bcf PORTA, 4
1052    02AC    1285        bcf PORTA, 5
1053    02AD    1009        bcf PORTE, 0
1054    02AE    1089        bcf PORTE, 1
1055    02AF    1505        bsf PORTA, 2
1056    02B0    1585        bsf PORTA, 3
1057    02B1            
1058    02B1    1407    	bsf PORTC, 0
1059    02B2    1087    	bcf PORTC, 1
1060    02B3    1107    	bcf PORTC, 2
1061    02B4    1187    	bcf PORTC, 3
1062    02B5    2A9D        goto	endshow
1063    02B6            case2d
1064    02B6    1485        bsf PORTA, 1
1065    02B7    1505        bsf PORTA, 2
1066    02B8    1605        bsf PORTA, 4
1067    02B9    1685        bsf PORTA, 5
1068    02BA    1489        bsf PORTE, 1
1069    02BB    1185        bcf PORTA, 3
1070    02BC    1009        bcf PORTE, 0
1071    02BD            
1072    02BD    1007    	bcf PORTC, 0
1073    02BE    1487    	bsf PORTC, 1
1074    02BF    1107    	bcf PORTC, 2
1075    02C0    1187    	bcf PORTC, 3
1076    02C1    2A9D        goto	endshow
1077    02C2            case3d
1078    02C2    1485        bsf PORTA, 1
1079    02C3    1505        bsf PORTA, 2
1080    02C4    1585        bsf PORTA, 3
1081    02C5    1605        bsf PORTA, 4
1082    02C6    1489        bsf PORTE, 1
1083    02C7    1009        bcf PORTE, 0
1084    02C8    1285        bcf PORTA, 5
1085    02C9            
1086    02C9    1407    	bsf PORTC, 0
1087    02CA    1487    	bsf PORTC, 1
1088    02CB    1107    	bcf PORTC, 2
1089    02CC    1187    	bcf PORTC, 3
1090    02CD    2A9D        goto	endshow
1091    02CE            case4d
1092    02CE    1505        bsf PORTA, 2
1093    02CF    1585        bsf PORTA, 3
1094    02D0    1409        bsf PORTE, 0
1095    02D1    1489        bsf PORTE, 1
1096    02D2    1085        bcf PORTA, 1
1097    02D3    1205        bcf PORTA, 4
1098    02D4    1285        bcf PORTA, 5
1099    02D5            
1100    02D5    1007    	bcf PORTC, 0
1101    02D6    1087    	bcf PORTC, 1
1102    02D7    1507    	bsf PORTC, 2
1103    02D8    1187    	bcf PORTC, 3
1104    02D9    2A9D        goto	endshow
1105    02DA            case5d
1106    02DA    1585        bsf PORTA, 3
1107    02DB    1605        bsf PORTA, 4
1108    02DC    1409        bsf PORTE, 0
1109    02DD    1489        bsf PORTE, 1
1110    02DE    1485        bsf PORTA, 1
1111    02DF    1285        bcf PORTA, 5
1112    02E0    1105        bcf PORTA, 2
1113    02E1            
1114    02E1    1407    	bsf PORTC, 0
1115    02E2    1087    	bcf PORTC, 1
1116    02E3    1507    	bsf PORTC, 2
1117    02E4    1187    	bcf PORTC, 3
1118    02E5    2A9D        goto	endshow
1119    02E6            case6d
1120    02E6    1585        bsf PORTA, 3
1121    02E7    1605        bsf PORTA, 4
1122    02E8    1685        bsf PORTA, 5
1123    02E9    1409        bsf PORTE, 0
1124    02EA    1489        bsf PORTE, 1
1125    02EB    1485        bsf PORTA, 1
1126    02EC    1105        bcf PORTA, 2
1127    02ED            
1128    02ED    1007    	bcf PORTC, 0
1129    02EE    1487    	bsf PORTC, 1
1130    02EF    1507    	bsf PORTC, 2
1131    02F0    1187    	bcf PORTC, 3
1132    02F1    2A9D        goto	endshow
1133    02F2            case7d
1134    02F2    1485        bsf PORTA, 1
1135    02F3    1505        bsf PORTA, 2
1136    02F4    1585        bsf PORTA, 3
1137    02F5    1205        bcf PORTA, 4
1138    02F6    1285        bcf PORTA, 5
1139    02F7    1009        bcf PORTE, 0
1140    02F8    1089        bcf PORTE, 1
1141    02F9            
1142    02F9    1407    	bsf PORTC, 0
1143    02FA    1487    	bsf PORTC, 1
1144    02FB    1507    	bsf PORTC, 2
1145    02FC    1187    	bcf PORTC, 3
1146    02FD    2A9D        goto	endshow
1147    02FE            case8d
1148    02FE    1485        bsf PORTA, 1
1149    02FF    1505        bsf PORTA, 2
1150    0300    1585        bsf PORTA, 3
1151    0301    1605        bsf PORTA, 4
1152    0302    1685        bsf PORTA, 5
1153    0303    1409        bsf PORTE, 0
1154    0304    1489        bsf PORTE, 1
1155    0305            
1156    0305    1007    	bcf PORTC, 0
1157    0306    1087    	bcf PORTC, 1
1158    0307    1107    	bcf PORTC, 2
1159    0308    1587    	bsf PORTC, 3
1160    0309    2A9D        goto	endshow
1161    030A            case9d
1162    030A    1485        bsf PORTA, 1
1163    030B    1505        bsf PORTA, 2
1164    030C    1585        bsf PORTA, 3
1165    030D    1605        bsf PORTA, 4
1166    030E    1409        bsf PORTE, 0
1167    030F    1489        bsf PORTE, 1
1168    0310    1285        bcf PORTA, 5
1169    0311            
1170    0311    1407    	bsf PORTC, 0
1171    0312    1087    	bcf PORTC, 1
1172    0313    1107    	bcf PORTC, 2
1173    0314    1587    	bsf PORTC, 3
1174    0315    2A9D        goto	endshow
1175    0316            ;----------------------------------------------------------------------------------
1176    0316            					;COMUNICACION
1177    0316            ENVIARDEC ; Decide que enviar encicladamente
1178    0316    2137    	CALL	DELAY_D
1179    0317    3001    	MOVLW	B'00000001'
1180    0318    0243    	SUBWF	CONE, 0
1181    0319    1903    	BTFSC	STATUS, Z
1182    031A    234E    	CALL	ENVIARGM ; enviar grupo mayor
1183    031B    2137    	CALL	DELAY_D
1184    031C    3002    	MOVLW	B'00000010'
1185    031D    0243    	SUBWF	CONE, 0
1186    031E    1903    	BTFSC	STATUS, Z
1187    031F    2354    	CALL	ENVIARVM ; enviar valor mayor
1188    0320    2137    	CALL	DELAY_D
1189    0321    3003    	MOVLW	B'00000011'
1190    0322    0243    	SUBWF	CONE, 0
1191    0323    1903    	BTFSC	STATUS, Z
1192    0324    235A    	CALL	ENVIARGMM ; enviar grupo menor
1193    0325    2137    	CALL	DELAY_D
1194    0326    3004    	MOVLW	B'00000100'
1195    0327    0243    	SUBWF	CONE, 0
1196    0328    1903    	BTFSC	STATUS, Z
1197    0329    2360    	CALL	ENVIARVMM ; enviar valor menor
1198    032A    2137    	CALL	DELAY_D
1199    032B    3005    	MOVLW	B'00000101'
1200    032C    0243    	SUBWF	CONE, 0
1201    032D    1903    	BTFSC	STATUS, Z
1202    032E    2388    	CALL	FINENV; hacer comparacion	
1203    032F    0AC3    	INCF	CONE, 1	
1204    0330    0008    	RETURN
1205    0331            
1206    0331            SETBITS
1207    0331    1821    	BTFSC	DATO, 0
1208    0332    2B3E    	GOTO	SET11
1209    0333    2B40    	GOTO	SET10
1210    0334            SETBITS1
1211    0334    18A1    	BTFSC	DATO, 1
1212    0335    2B42    	GOTO	SET21
1213    0336    2B44    	GOTO	SET20
1214    0337            SETBITS2
1215    0337    1921    	BTFSC	DATO, 2
1216    0338    2B46    	GOTO	SET31
1217    0339    2B48    	GOTO	SET30
1218    033A            SETBITS3
1219    033A    19A1    	BTFSC	DATO, 3
1220    033B    2B4A    	GOTO	SET41
1221    033C    2B4C    	GOTO	SET40
1222    033D            ENDSET
1223    033D    0008    	RETURN	
1224    033E            
1225    033E            SET11
1226    033E            	;BSF	PORTB, 1
1227    033E    1607    	BSF	PORTC, 4 ;***************************
1228    033F    2B34    	GOTO	SETBITS1
1229    0340            SET10
1230    0340            	;BCF	PORTB, 1
1231    0340    1607    	BSF	PORTC, 4 ;***************************
1232    0341    2B34    	GOTO	SETBITS1
1233    0342            	
1234    0342            SET21
1235    0342            	;BSF	PORTB, 2
1236    0342    1687    	BSF	PORTC, 5 ;***************************
1237    0343    2B37    	GOTO	SETBITS2
1238    0344            SET20
1239    0344            	;BCF	PORTB, 2
1240    0344    1687    	BSF	PORTC, 5 ;***************************
1241    0345    2B37    	GOTO	SETBITS2
1242    0346            	
1243    0346            SET31
1244    0346            	;BSF	PORTB, 3
1245    0346    1707    	BSF	PORTC, 6 ;***************************
1246    0347    2B3A    	GOTO	SETBITS3
1247    0348            SET30
1248    0348            	;BCF	PORTB, 3
1249    0348    1707    	BSF	PORTC, 6 ;***************************
1250    0349    2B3A    	GOTO	SETBITS3
1251    034A            	
1252    034A            SET41
1253    034A            	;BSF	PORTB, 4
1254    034A    1787    	BSF	PORTC, 7 ;***************************
1255    034B    2B3D    	GOTO	ENDSET
1256    034C            SET40
1257    034C            	;BCF	PORTB, 4
1258    034C    1787    	BSF	PORTC, 7 ;***************************
1259    034D    2B3D    	GOTO	ENDSET
1260    034E            	
1261    034E            ENVIARGM
1262    034E    0844    	MOVF	MAYG, W
1263    034F    00A1    	MOVWF 	DATO
1264    0350    2331    	CALL	SETBITS
1265    0351            	;BTFSC	PORTB, 0
1266    0351    1B08    	BTFSC	PORTD, 6 ;***********************
1267    0352    2B4E    	GOTO	ENVIARGM 
1268    0353    0008    	RETURN
1269    0354            	
1270    0354            ENVIARVM
1271    0354    0845    	MOVF	MAYV, W
1272    0355    00A1    	MOVWF 	DATO
1273    0356    2331    	CALL	SETBITS	
1274    0357            	;BTFSC	PORTB, 0
1275    0357    1B08    	BTFSC	PORTD, 6 ;***********************
1276    0358    2B54    	GOTO	ENVIARVM 
1277    0359    0008    	RETURN
1278    035A            	
1279    035A            ENVIARGMM
1280    035A    0846    	MOVF	MENG, W
1281    035B    00A1    	MOVWF 	DATO
1282    035C    2331    	CALL	SETBITS	
1283    035D            	;BTFSC	PORTB, 0
1284    035D    1B08    	BTFSC	PORTD, 6 ;***********************
1285    035E    2B5A    	GOTO	ENVIARGMM 
1286    035F    0008    	RETURN
1287    0360            	
1288    0360            ENVIARVMM
1289    0360    0847    	MOVF	MENV, W
1290    0361    00A1    	MOVWF 	DATO
1291    0362    2331    	CALL	SETBITS	
1292    0363            	;BTFSC	PORTB, 0
1293    0363    1B08    	BTFSC	PORTD, 6 ;***********************
1294    0364    2B60    	GOTO	ENVIARVMM 
1295    0365    0008    	RETURN
1296    0366            
1297    0366            RECIBIRDEC ; recibe encicladamente
1298    0366    2137    	CALL	DELAY_D
1299    0367    3001    	MOVLW	B'00000001'
1300    0368    0242    	SUBWF	CONR, 0
1301    0369    1903    	BTFSC	STATUS, Z
1302    036A    23AA    	CALL	RECIBIRGM ; enviar grupo mayor
1303    036B    2137    	CALL	DELAY_D
1304    036C    3002    	MOVLW	B'00000010'
1305    036D    0242    	SUBWF	CONR, 0
1306    036E    1903    	BTFSC	STATUS, Z
1307    036F    23B0    	CALL	RECIBIRVM ; enviar valor mayor
1308    0370    2137    	CALL	DELAY_D
1309    0371    3003    	MOVLW	B'00000011'
1310    0372    0242    	SUBWF	CONR, 0
1311    0373    1903    	BTFSC	STATUS, Z
1312    0374    23B6    	CALL	RECIBIRGMM ; enviar grupo menor
1313    0375    2137    	CALL	DELAY_D
1314    0376    3004    	MOVLW	B'00000100'
1315    0377    0242    	SUBWF	CONR, 0
1316    0378    1903    	BTFSC	STATUS, Z
1317    0379    23BC    	CALL	RECIBIRVMM ; enviar valor menor	
1318    037A    2137    	CALL	DELAY_D
1319    037B    3005    	MOVLW	B'00000101'
1320    037C    0242    	SUBWF	CONR, 0
1321    037D    1903    	BTFSC	STATUS, Z
1322    037E    2381    	CALL	FINREC; hacer comparacion	
1323    037F    0AC2    	INCF	CONR, 1			
1324    0380    0008    	RETURN
1325    0381            	
1326    0381            FINREC
1327    0381    3000    	MOVLW	B'00000000'
1328    0382    00C2    	MOVWF   CONR
1329    0383    23C2    	CALL	COMPAREMAYORG
1330    0384    23CD    	CALL	COMPAREMENORG
1331    0385    1808    	BTFSC	PORTD, 0
1332    0386    2B81    	GOTO	FINREC 
1333    0387    0008    	RETURN
1334    0388            	
1335    0388            FINENV
1336    0388    3000    	MOVLW	B'00000000'
1337    0389    00C3    	MOVWF   CONE
1338    038A            	;BTFSC	PORTB, 0
1339    038A    1B08    	BTFSC	PORTD, 6 ;****************************
1340    038B    2B88    	GOTO	FINENV
1341    038C    0008    	RETURN
1342    038D            	
1343    038D            SET11R
1344    038D    1421    	BSF	DATO, 0
1345    038E    2BA0    	GOTO	SETBITS1R
1346    038F            SET10R
1347    038F    1021    	BCF	DATO, 0
1348    0390    2BA0    	GOTO	SETBITS1R
1349    0391            	
1350    0391            SET21R
1351    0391    14A1    	BSF	DATO, 1
1352    0392    2BA3    	GOTO	SETBITS2R
1353    0393            SET20R
1354    0393    10A1    	BCF	DATO, 1
1355    0394    2BA3    	GOTO	SETBITS2R
1356    0395            	
1357    0395            SET31R
1358    0395    1521    	BSF	DATO, 2
1359    0396    2BA6    	GOTO	SETBITS3R
1360    0397            SET30R
1361    0397    1121    	BCF	DATO, 2
1362    0398    2BA6    	GOTO	SETBITS3R
1363    0399            	
1364    0399            SET41R
1365    0399    15A1    	BSF	DATO, 3
1366    039A    2BA9    	GOTO	ENDSETR
1367    039B            SET40R
1368    039B    11A1    	BCF	DATO, 3
1369    039C    2BA9    	GOTO	ENDSETR
1370    039D            
1371    039D            SETBITSR
1372    039D    1987    	BTFSC	PORTC, 3
1373    039E    2B8D    	GOTO	SET11R
1374    039F    2B8F    	GOTO	SET10R
1375    03A0            SETBITS1R
1376    03A0    1907    	BTFSC	PORTC, 2
1377    03A1    2B91    	GOTO	SET21R
1378    03A2    2B93    	GOTO	SET20R
1379    03A3            SETBITS2R
1380    03A3    1887    	BTFSC	PORTC, 1
1381    03A4    2B95    	GOTO	SET31R
1382    03A5    2B97    	GOTO	SET30R
1383    03A6            SETBITS3R
1384    03A6    1807    	BTFSC	PORTC, 0
1385    03A7    2B99    	GOTO	SET41R
1386    03A8    2B9B    	GOTO	SET40R
1387    03A9            ENDSETR
1388    03A9    0008    	RETURN	
1389    03AA            
1390    03AA            	
1391    03AA            RECIBIRGM
1392    03AA    239D    	CALL	SETBITSR
1393    03AB    0821    	MOVF	DATO, W
1394    03AC    00C8    	MOVWF	MAYBG
1395    03AD    1808    	BTFSC	PORTD, 0
1396    03AE    2BAA    	GOTO	RECIBIRGM 
1397    03AF    0008    	RETURN	
1398    03B0            	
1399    03B0            RECIBIRVM
1400    03B0    239D    	CALL	SETBITSR
1401    03B1    0821    	MOVF	DATO, W
1402    03B2    00C9    	MOVWF	MAYBV
1403    03B3    1808    	BTFSC	PORTD, 0
1404    03B4    2BB0    	GOTO	RECIBIRVM 
1405    03B5    0008    	RETURN
1406    03B6            
1407    03B6            RECIBIRGMM
1408    03B6    239D    	CALL	SETBITSR
1409    03B7    0821    	MOVF	DATO, W
1410    03B8    00CA    	MOVWF	MENBG
1411    03B9    1808    	BTFSC	PORTD, 0
1412    03BA    2BB6    	GOTO	RECIBIRGMM 
1413    03BB    0008    	RETURN	
1414    03BC            
1415    03BC            RECIBIRVMM
1416    03BC    239D    	CALL	SETBITSR
1417    03BD    0821    	MOVF	DATO, W
1418    03BE    00CB    	MOVWF	MENBV
1419    03BF    1808    	BTFSC	PORTD, 0
1420    03C0    2BBC    	GOTO	RECIBIRVMM 
1421    03C1    0008    	RETURN
1422    03C2            
1423    03C2            COMPAREMAYORG 
1424    03C2    0845    	MOVF  MAYV, W
1425    03C3    0249    	SUBWF MAYBV, W
1426    03C4    1C03    	BTFSS STATUS, C       
1427    03C5    2BCC    	GOTO  NOCHANGEMAY
1428    03C6    2BC7    	GOTO  CHANGEMAY	                        
1429    03C7            
1430    03C7            CHANGEMAY
1431    03C7    0848    	MOVF  MAYBG, W 
1432    03C8    00C4            MOVWF MAYG
1433    03C9    0849            MOVF  MAYBV, W
1434    03CA    00C5            MOVWF MAYV
1435    03CB    0008    	RETURN
1436    03CC            
1437    03CC            NOCHANGEMAY
1438    03CC    0008    	RETURN
1439    03CD            	
1440    03CD            COMPAREMENORG 
1441    03CD    0847    	MOVF  MENV, W
1442    03CE    024B    	SUBWF MENBV, W
1443    03CF    1C03    	BTFSS STATUS, C  
1444    03D0    2BD2    	GOTO  CHANGEMEN     
1445    03D1    2BD7    	GOTO  NOCHANGEMEN	                        
1446    03D2            
1447    03D2            CHANGEMEN
1448    03D2    084A    	MOVF  MENBG, W 
1449    03D3    00C6            MOVWF MENG
1450    03D4    084B            MOVF  MENBV, W
1451    03D5    00C7            MOVWF MENV
1452    03D6    0008    	RETURN
1453    03D7            
1454    03D7            NOCHANGEMEN
1455    03D7    0008    	RETURN
1456    03D8            END
---------------------------------------------
Number of errors = 0
